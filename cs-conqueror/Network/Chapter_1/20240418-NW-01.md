# 20240418 1차 네트워크 스터디

일시 : 2022 - 04 - 18 (목)

작성자 : 이강현

참여자 : 최은혜, 최다환

범위 : [컴퓨터 네트워킹 하향식 접근 8판: James F. Kurose, Keith W. Ross 저]]

ch1. 컴퓨터 네트워크와 인터넷

<hr>

## 1.1 인터넷이란 무엇인가?

1. 인터넷을 구성하는 기본적인 **하드웨어 & 소프트웨어** 구성요소에 대한 기술 (1.1.1)
2. 분산 애플리케이션에 서비스를 제공하는 **네트워킹 인프라스트럭처 관점에서의 인터넷**을 기술 (1.1.2)

### 1.1.1 구성 요소로 본 인터넷

#### 인터넷(Internet)
- Network of Network
- 전 세계적으로 수십억 개의 컴퓨팅 장치를 연결하는 컴퓨터 네트워크
<br/>

#### 호스트(host), 종단 시스템(end system)

- 컴퓨터 네트워크에 연결된 컴퓨팅 장치
- 서버 (데스크탑 PC, 리눅스 워크스테이션, 웹페이지 등), 인터넷에 연결된 모든 인터넷 ‘사물들’ (TV, 스마트 워치 등)
- 통신 링크(communication link)와 패킷 스위치(packet switch)의 네트워크로 연결

<br/>

#### 통신 링크(communication link)

- 다양한 전송률(transmission rate, 링크 대역폭 또는 bandwith)을 이용해 패킷(데이터)을 전송
- 전송률의 단위 : **bps(bits per second, 초당 비트 수)**
- 동축케이블, 구리선, 광케이블, 라디오 스펙트럼을 포함한 다양한 물리 매체로 구성

<br/>

#### 패킷(packet)

- 송신 종단 시스템에서 수신 종단 시스템(목적지)으로 보냄
- 송신 종단 시스템이 **보내고자 하는 데이터를 세그먼트로 나누고**, 각 세그먼트에 헤더를 부착하여 수신 종단 시스템으로 전송
- 패킷은 **목적지에서 원래의 데이터로 다시 조립됨**

<br/>

#### 패킷 교환기, 패킷 스위치(packet switch)

- 입력 통신 링크 중 하나
- 도착하는 패킷을 받아서 출력 통신 링크의 하나로 그 패킷을 전달 **(최종 목적지 방향으로 패킷을 전달)**
- 대표적인 두 종류
    - 링크 계층 스위치(link-layer switch) : 보통 접속 네트워크에서 사용
    - 라우터(router) : 보통 네트워크 코어에서 사용

<br/>

#### 경로(route, path)

- 패킷이 송신 종단 시스템에서 보내진 후 **수신 종단 시스템에 도달하는 동안 거쳐온** 일련의 통신 링크와 패킷 스위치를 말함
- **패킷은 컴퓨터 네트워크를 통한 경로를 따름**

<br/>

#### ISP(Internet Service Provider)

- 패킷 스위치와 통신 링크로 이루어진 네트워크
- 종단 시스템에게 다양한 네트워크 접속을 제공 (가정용 초고속 접속, 고속 LAN 접속, 이동 무선 접속 등)
- CP(content provider)에게 인터넷 접속을 제공 → 웹 사이트나 비디오 서버를 인터넷에 직접 연결할 수 있게 됨
- ISP들의 상호 연결
  > 인터넷은 종단 시스템을 서로 연결하는 것이므로 **종단 시스템에 접속을 제공하는 ISP들도 서로 연결되어야만 함**
    - 하위 계층 ISP는 국가 & 국제 상위 계층 ISP를 통해 서로 연결한다. - 상위 계층 ISP들은 서로 직접 연결
    - 각 ISP 네트워크는 따로 관리되고, IP 프로토콜을 수행하며, 네이밍(naming)과 주소배정 방식을 따름

<br/>

#### 프로토콜(protocol)

- 인터넷에서 정보의 송수신을 제어
- 가장 중요한 프로토콜 둘을 통칭하여 **TCP/IP**라고 함
    - TCP(Transmission Control Protocol)
    - IP(Internet Protocol) : 라우터와 종단 시스템 사이에서 송수신되는 패킷 포맷을 기술

<br/>

### 1.1.2 서비스 측면에서 본 인터넷

#### 인터넷은 애플리케이션에 서비스를 제공하는 Infrastructure

- 애플리케이션은 서로 데이터를 교환하는 많은 종단 시스템을 포함하고 있기 때문에 분산 애플리케이션이라고 부름
- **인터넷 애플리케이션은 종단 시스템에서 수행되며**, 네트워크 코어에 있는 패킷 교환기에서 수행되지 않음

<br/>

### 1.1.3 프로토콜이란 무엇인가?

둘 이상의 통신 개체(entity)가 어떤 일을 함께 수행하려면 **이들이 다같이 인식하는 프로토콜 즉, 통신 규약이 필요**

- 메세지의 송수신과 메시지를 송수신할 때 취하는 행동은 프로토콜의 중심에 있음
- 따라서 하나가 다른 프로토콜을 수행한다면 그 프로토콜은 다른 이들과 상호작용할 수 없으며, 원하는 작업을 수행할 수 없음

<br/>

#### 네트워크 프로토콜

- 통신하는 둘 이상의 원격 개체가 포함된 **인터넷에서의 모든 활동은 프로토콜이 제어**
- ex)
    - 혼잡 제어(congestion-control) 프로토콜 : 종단 시스템에 존재하며, 송수신자 간에 전송되는 패킷 전송률을 조절한다.
    - 라우터에서의 프로토콜 : 출발지(source)에서 목적지(destination)까지의 패킷 경로를 설정한다.

<br/>

## 1.2 접속 네트워크

#### 호스트(host), 종단 시스템(end system)

- **인터넷에 연결되는 컴퓨터와 그 밖의 장치들**
- 인터넷의 가장 자리를 차지하고 있기 때문에 **‘종단’ 시스템**이라고 부름
- 종단 시스템은 애플리케이션을 수행하므로 **호스트**라고도 부르며, 호스트는 클라이언트와 서버로 구분

<br/>

### 1.2.1 접속 네트워크

#### 접속 네트워크(access network)

종단 시스템을 먼 거리에 위치한 다른 종단 시스템까지의 경로 상에 있는 첫 번째 라우터 즉, **가장 자리 라우터(edge router)에 연결하는 네트워크**를 말함

<br/>

네트워크 접속 기술들에 대하여 차례대로 알아보자.

- 가정 접속 : DSL, 케이블, FTTH, 5G 고정 무선 기술
- 기업(그리고 가정) 접속 : 이더넷, 와이파이
- 광역 무선 접속 : 3G, LTE 4G, 5G

<br/>

### 가정 접속

- 오늘날(2020년) 가장 널리 보급된 광대역 가정 접속 유형들
    - DSL : 지역 전화 회사(telco)의 **기존 로컬 전화 인프라스트럭처**를 이용
    - 케이블 : 케이블 TV 회사의 **기존 케이블 TV 인프라스트럭처**를 이용


- FTTH : 위의 접속 유형들보다 빠른 속도를 제공하는 미래 기술

<br/>

#### DSL(Digital Subscriber Line) 인터넷 접속

가정은 유선 로컬 전화 서비스를 제공하는 같은 **지역 전화 회사(telco)로부터** DSL 인터넷 접속 서비스를 받음

<br/>

#### DSL 모뎀

가정의 DSL 모뎀은 텔코의 지역 중앙국(Central Office, CO)에 위치한 **DSLAM(Digital Subscriber Line Access Multiplexer)과 데이터를 교환하기 위해**  
기존 전화 회선을 이용

1. 가정의 DSL 모뎀은 수신한 디지털 데이터를 전화선을 통해 CO로 전송하기 위해, 해당 데이터를 고주파 신호로 변환
2. 여러 가정으로부터의 아날로그 신호는 **DSLAM에서 디지털 포맷으로 다시 변환됨**

<br/>

#### 스플리터 (splitter)

- 가정 쪽에 존재
- 역할
    1. 가정에 도착하는 데이터와 전화 신호를 분리
    2. 데이터 신호를 DSL 모뎀으로 전송

<br/>

#### DSLAM(Digital Subscriber Line Access Multiplexer)

- 수백 ~ 수천 개의 가정들이 DSLAM에 연결
- 역할
    1. 데이터와 전화 신호를 분리
    2. 데이터를 인터넷으로 송신

<br/>

#### DSL 표준

- DSL 표준은 여러 `전송률`을 정의하며, 이 전송률에는 업스트림과 다운스트림을 포함 **(다운스트림 채널이 업스트림 채널보다 빠른 전송률이 할당됨)**
    - `업스트림` 속도 : 3.5 Mbps, 16 Mbps
    - `다운스트림` 속도 : 24 Mbps, 52 Mbps

<br/>

- 최신 표준 : 업스트림과 다운스트림을 결합한 1 Gbps 속도를 정의 (ITU 2014)
    - 다운스트림과 업스트림의 속도가 다르기 때문에 이 접속 방식을 **비대칭(asymmetric)**이라고 함

<br/>

#### 케이블 인터넷 접속, HFC(Hybrid Fiber Coax)

가정은 **케이블 TV 서비스를 제공하는 같은 회사로부터** 인터넷 접속 서비스를 받음

광케이블은 `케이블 헤드엔드`를 이웃 레벨 정션에 연결하며, 이로부터 가정들에 도달하는 데에는 전통적인 `동축케이블`이 사용됨

<br/>

#### 헤드엔드(head-end)

- (유선 TV의) 전파 (조정) 중계소, 중계국 / 주전송장치(분배센터)
- 각 데이터 국으로부터 수신된 신호를 많은 세대가 시청할 수 있도록 **신호를 가공, 증폭한 다음 분배**해주는 시설
- 유선 TV 방송을 위해 전파를 증폭, 조정, 변환, 투입차단 또는 혼합하여 선로로 송출하는 장치들과 신호를 간선 케이블로 송출하는 모든 설비를 말함

<br/>

#### 케이블 모뎀

- 케이블 인터넷 접속을 위한 모뎀
- `이더넷 포트`를 통해 가정 PC에 연결
- 케이블 헤드엔드에서 `CMTS(Cable Modem Termination System)`가 존재
- 이는 HFC 네트워크를 다운스트림과 업스트림 채널 2개로 나눔
    - 비대칭 접속
    - 다운스트림 채널이 업스트림 채널보다 빠른 전송률이 할당

<br/>

#### CMTS(Cable Modem Termination System)

- 많은 다운스트림 가정에 있는 **케이블 모뎀으로부터 송신된 아날로그 신호를 다시 디지털 포맷으로 변환**하는 역할
- 즉, 이는 DSL 네트워크의 DSLAM와 유사한 기능을 함
- 
<br/>

#### FTTH(Fiber to the Home) 인터넷 접속

- 지역 중앙국(Central Office, CO)으로부터 가정까지 **직접 광섬유 경로를 제공**
- 잠재적으로 Gbps의 인터넷 접속 속도를 제공할 수 있음
- `광신호 분배 기술` : CO로부터 가정까지 광신호를 분해하는 기술들을 말함

<br/>

#### 다이렉트 광섬유(direct fiber)

- 가장 간단한 광신호 분배 네트워크
- CO에서 각 가정으로 하나의 광섬유를 제공

<br/>

#### AON(Active Optical Network)과 PON(Passive Optical Network)

스플리팅을 수행하는 두 가지 경쟁적인 **광신호 분배 네트워크 구조**들

`스플리팅(splitting)` : 일반적으로 CO에서 시작되는 각 광섬유는 여러 가정이 공유하기 때문에,  
**가정에 가까운 곳까지 하나의 광섬유로 온 다음 고객별 광섬유로 분리**하는 것

- `AON` : 근본적인 교환(switched) 이더넷
- `PON` : 아래 그림 참고 (PON 분배 구조를 이용하는 FTTH 인터넷 접속)

  이처럼 각 가정에서의 사용자는 홈 라우터를 ONT에 연결하고, 그를 통해 인터넷에 접속
  
  인터넷 접속 절차는 아래와 같이 정리할 수 있음
    1. 각 가정은 `ONT(Optical Network Terminator)`를 가지고 있으며, 이는 지정된 광섬유로 **이웃 스플리터에 연결**
    2. `스플리터(Optical Splitter)`는 여러 가정을 **하나의 공유 광섬유로 결합**, 이를 텔코의 CO에 있는 `OLT(Optical Line Terminator)`에 연결
    3. OLT는 **광신호와 전기 신호 간의 변환**을 제공, 이는 텔코 라우터를 통해 `인터넷`에 연결

<br/>

#### 5G 고정 무선(5G Fixed Wireless, 5G-FW) 기술

- `빔포밍(beam-forming) 기술`을 이용하여 서비스 제공가의 기지국에서 가정 내의 모뎀으로 데이터를 **무선으로** 전송함
- 와이파이(WiFi) 무선 라우터가 케이블 또는 DSL 모뎀에 연결되어 있듯, 5G-FW에서도 와이파이 무선 라우터가 모뎀에 연결되어 있음
- `5G 셀룰러(cellular) 네트워크`

<br/>

### 기업(그리고 가정) 접속

#### LAN(Local Area Network)

- **종단 시스템을 가장자리 라우터에 연결**하는 데 사용됨
- 여러 유형의 LAN 기술 중, `이더넷 기술`이 기업, 대학, 홈 네트워크에서 가장 널리 사용되는 접속 기술

<br/>

#### 이더넷(**Ethernet)**

- 이더넷 스위치에 연결하기 위해 `꼬임쌍선`을 이용
- 이더넷 스위치 혹은 상호연결된 스위치들의 네트워크는 다시 더 큰 인터넷으로 연결됨

<br/>

#### 무선 랜(wireless LAN) 환경

점차 사람들은 인터넷을 ‘사물(스마트폰, 태블릿 등)’에서 **무선으로** 접속하고 있음

- 무선 랜 환경에서 무선 사용자들은 기업 네트워크에 연결된 `AP(Access Point)`로 패킷을 송•수신
- AP는 유선 네트워크에 다시 연결됨
- `와이파이(WiFi)` : IEEE 802.11 기술에 기반한 무선 랜 접속

<br/>

### 광역 무선 접속

- **무선 인프라스트럭처를 채택** (이동 전화망 사업자들이 운영하는 기지국을 통해 패킷을 송수신하는 데 사용하는 것과 같은 것임)
- 수십 미터 반경 내에 있어야 하는 와이파이와 달리, 사용자는 **기지국의 수십 킬로미터 반경 내**에 있으면 됨

<br/><br/>

### 1.2.2 물리 매체

인터넷에서 공통적으로 사용하는 물리 매체들과 그 밖의 매체들에 대하여 살펴보자.

<br/>

#### 물리 매체(physical media)

물리 매체를 정의하기 위해서는 비트에 대해 먼저 알아야 한다.

<br/>

```
한 종단 시스템에서 여러 링크와 라우터를 거쳐 다른 종단 시스템으로 한 비트가 전달되는 상황을 생각
```

- 이 비트는 여러 라우터를 거침 (첫 번째 라우터 : 비트를 수신 & 전송 → 두 번째 라우터 : 비트를 수신 & 전송 → 세 번째 라우터 : … )
- 즉, 비트는 출발지에서 목적지로 전달될 때 여러 번 걸쳐 전송되며, `일련의 송신기-수신기 쌍`을 거침

<br/>

> 비트는 **물리 매체(physical media)상에** 전자파나 광 펄스를 전파하여 전송

- 물리 매체는 여러 형태이며, **경로상의 각 송신기-수신기 쌍에 대해 같은 유형일 필요는 없음**
- ex) 꼬임쌍선, 동축케이블, 다중모드 광섬유 케이블, 지상파와 위성파 등
- 두 가지 종류
    - `유도 매체(guided media)` : 꼬임쌍선, 동축케이블, 광섬유 케이블과 같은 **견고한 매체를 따라 파형을 유도**
    - `비유도 매체(unguided media)` : 무선 랜 혹은 디지털 위성 채널처럼 **야외 공간으로 파형을 전파**

<br/>

#### 꼬임쌍선

- 가장 싸고 가장 많이 이용하는 전송 매체 (전화기에서 전화국 스위치까지 유선 연결의 99% 이상이 이를 이용)
- 구성
    - 2개의 절연 구리선, 각각은 약 1mm 굵기로 **규칙적인 나선 형태**로 배열
    - 이웃하는 쌍들 간에 전기 간섭을 줄이기 위해 선들이 꼬여 있는 것이며, **이러한 한 쌍의 선이 하나의 통신 링크를 구성**
- 데이터 전송률 : **전송선의 두께, 송신기와 수신기 사이의 거리**에 따라 다름
- 사용 : UTF(Unshielded Twisted Pair) - 빌딩의 컴퓨터 네트워크, LAN에서 가장 많이 이용하는 매체

<br/>

#### 지상 라디오 채널

- 전자기 스펙트럼으로 신호를 전달
- 특징
    - 물리 선로를 설치할 필요가 없음
    - 벽을 관통할 수 있음
    - 이동 사용자에게 연결성을 제공하며, 먼 거리까지 신호 전달이 가능
    - 전파 환경과 신호가 전달되는 거리에 많은 영향을 받음
        - 주변 환경을 결정하는 요소
            - `경로손실(path loss)`
            - `섀도 페이딩(shadow fading)` : 신호가 먼 거리를 지나감에 따라 / 방해 물질을 돌아가거나 통과함에 따라 신호 강도가 약해지는 현상
            - `다중경로 페이딩` : 간섭 물체의 신호 반사 때문에 발생
            - `간섭` : 다른 라디오 채널이나 전자기 신호 때문에 발생
- 크게 3개의 그룹으로 분류
    - 1~2 m의 매우 짧은 거리에서 동작하는 채널 (무선 헤드셋, 키보드 등)
    - 로컬 라디오 채널 : 십~수백 미터에 걸쳐 근거리 네트워크로 동작하는 채널 (무선 랜 기술)
    - 광역 라디오 채널 : 수십 킬로미터에 걸쳐 광역에서 작동하는 채널 (셀룰러 접속 기술)

<br/>

#### 위성 라디오 채널

- `지상 스테이션`이라는 둘 이상의 지상 기반 마이크로파 송신기/수신기를 연결
- 과정
    1. 한 주파수 대역으로 전송 신호를 수신
    2. `리피터(repeater)`를 통해 그 신호를 재생
    3. 그 신호를 다른 주파수 대역으로 전송
- 전송률 : 초당 기가비트
- 두 가지 종류
    - `정지 위성(geostationary satellite)` : 지상 36,000 km에 쏘아올려져 일정 위치에 영원히 머무름
    - `저궤도 위성(low-earth orbiting(LEO) satellite)` : 지구를 공전하며 지상국뿐만 아니라 서로 통신할 수 있음
 
# 1.3 네트워크 코어

1.2절의 종단 시스템을 연결하는 패킷 스위치와 링크의 그물망(mesh)에 대하여 살펴보자

<br/>

**링크와 스위치의 네트워크를 통해 데이터를 이동시키는** 두 가지 기본 방식

1. `패킷 교환(packet switching)` : 보장 안 된 / 요구할 때만 링크의 사용을 할당
2. `회선 교환(circuit switching)` : 보장된 / 요구에 관계없이 미리 전송 링크의 사용을 할당


<br/>

## 1.3.1 패킷 교환(packet switching)

`패킷` : 출발지 종단 시스템에서 목적지 종단 시스템으로 메시지를 보내기 위해 송신 시스템이 긴 메시지를 작은 데이터 덩어리로 분할한 것

종단 시스템들은 서로 `메시지(message)`를 교환 (**출발지 종단 시스템에서 목적지 종단 시스템으로** 메시지를 보냄)

<br/>

1. 송신 시스템은 메시지를 `패킷(packet)`이라고 하는 작은 데이터 덩어리로 분할


2. 각 패킷은 `통신 링크(communication link)`와 `패킷 스위치(packet switch)`를 거치게 됨
    - 패킷 스위치에는 <b>라우터(router)</b>와 <b>링크 계층 스위치(link-layer switch)</b>의 두 가지 유형이 존재


3. 패킷은 **링크의 최대 전송률과 같은 속도로** 각각의 통신 링크에서 전송
    - 출발지 종단 시스템 혹은 패킷 스위치가 `R bps(bits per second)`의 속도로 링크에서 `L 비트`의 패킷을 송신한다면,  
      그 패킷을 전송하는 데 걸리는 시간은 `L/R 초`

<br/>
<br/>

### 저장-후-전달 전송(store-and-forward transmission) 방식

> 스위치가 패킷의 첫 비트를 출력 링크로 전송하기 전에 **전체 패킷**을 받아야 함

`저장-후-전달 전송 방식`은 대부분의 패킷 스위치가 이용하는 방식

<br/>

#### 경과 시간에 대한 계산

- 출발지는 목적지로 전송할 3개의 패킷(1, 2, 3)을 가지고 있으며, 각각의 패킷은 L 비트로 구성되어 있다.

- 출발지는 링크에서 L 비트의 패킷을 R bps(bits per second)의 속도로 송신하고 있다.

```
1-1. 출발지에서 패킷 1을 송신하기 시작해서 패킷 1의 전체를 목적지에서 수신할 때까지의 경과 시간을 계산해보자.
```

- `0 초` : 출발지가 패킷 1을 전송하기 시작
- `L/R 초`
    - 출발지는 패킷 1의 전체 데이터를 전송 완료했으며, 전체가 라우터에 수신되고 저장 (전파 지연이 없기 때문)
    - **라우터가 전체 패킷을 수신했기 때문에** 라우터는 목적지를 향해 그 패킷을 출력 링크로 전송하기 시작
- `2L/R 초` : 라우터는 전체 패킷을 전송했으며, 목적지는 패킷 1 전체를 수신 완료 (전파 지연이 없기 때문)

<br/>

따라서 저장-후-전달 전송 방식을 채택한다면 전체 지연은 `2L/R`이며,
이 방식 없이 스위치에 비트가 도착하자마자 곧바로 전달을 하게 된다면 전체 지연은 `L/R`

하지만 라우터는 전달하기에 앞서 전체 패킷을 수신, 저장, 처리할 필요가 있음

<br/>

```
1-2. 출발지가 패킷 1을 송신하기 시작한 순간부터 목적지 노드가 3개의 모든 패킷(1, 2, 3)을 수신할 때까지 경과된 전체 시간을 계산해보자.
```

- `0 초` : 출발지가 패킷 1을 전송하기 시작
- `L/R 초`
    - 라우터는 패킷 1을 수신 완료, 이를 전송하기 시작
    - 출발지는 패킷 2를 전송하기 시작
- `2L/R 초`
    - 라우터는 패킷 2를 수신 완료, 이를 전송하기 시작
    - 목적지는 패킷 1 전체를 수신 완료
    - 출발지는 패킷 3을 전송하기 시작
- `3L/R 초`
    - 라우터는 패킷 3를 수신 완료, 이를 전송하기 시작
    - 목적지는 패킷 2 전체를 수신 완료
- `4L/R 초` : 목적지는 패킷 3 전체를 수신 완료

<br/>

따라서 저장-후-전달 전송 방식을 채택한다면 목적지는 `4L/R` 초에 3개의 모든 패킷을 수신

<br/>

#### 종단 간 지연

```
2. 출발지로부터 목적지 노드까지 N개의 링크로 구성되고 각각은 전송률이 R인 경로를 통해 하나의 패킷을 전송하는 경우를 생각해보자.
```

즉, 출발지와 목적지 사이에 N-1개의 라우터가 존재한다는 것이다.

실제로 라우터는 보통 여러 개의 링크를 갖는데, 그 이유는 라우터의 기능이 **입력되는 패킷을 출력 링크로 교환**하는 것이기 때문이다.

<br/>
<br/>

### 큐잉 지연(queuing delay)과 패킷 손실

* 각 패킷 스위치는 접속된 여러 `링크`를 가지고 있으며, 패킷 스위치는 **각 링크에 대해** `출력 버퍼`**를 가지고 있음**
* 출력 버퍼(output buffer)는 출력 큐(output queue)로도 불리며, **그 링크로 송신하려고 하는 패킷을 저장하고 있음**  
  이는 `패킷 교환`에서 중요한 역할을 함

패킷이 겪는 지연은 앞에서 보았던 저장-후-전달 지연만 존재하는 것이 아님

<br/>

```
도착하는 패킷은 한 링크로 전송되어야 한다. 하지만 만약 그 링크가 다른 패킷을 전송하고 있는 중이라면 어떻게 해야 하는가?
```

**→ 도착하는 패킷은 출력 버퍼에서 대기해야 한다.** = `큐잉 지연`

- 큐잉 지연은 가변적이며, 네트워크의 혼잡 정도에 따름
- 버퍼 공간의 크기는 유한하기 때문에 `패킷 손실(packet loss)`이 발생할 수 있음
- 즉, 버퍼가 전송을 위해 대기 중인 다른 패킷들로 꽉 차 있는 경우라면 **도착하는 패킷 또는 큐에 대기 중인 패킷을 폐기**하는 것이다.

<br/>
<br/>

### 포워딩 테이블과 라우팅 프로토콜

> 라우터는 접속된 통신 링크 중 하나로 도착하는 패킷을 받아, **접속된 통신 링크 중 다른 링크로 그 패킷을 전달**
>

그렇다면 라우터는 그 패킷을 어느 링크로 전달해야 하는지를 어떻게 결정할까?

<br/>

#### IP 주소

- 인터넷에서 모든 종단 시스템은 IP 주소를 가지며, 이 주소는 계층적 구조를 가짐
- 출발지 종단 시스템이 목적이 종단 시스템으로 패킷을 보내고자 할 때 **출발지는 패킷의 헤더에 목적지의 IP 주소를 포함**

<br/>

#### 포워딩 테이블(forwarding table)

각 라우터는 **목적지 주소 또는 목적지 주소의 일부를 라우터의 출력 링크로 매핑**하는 포워딩 테이블을 가짐

따라서 라우터가 수신한 패킷을 어느 링크로 전달해야 하는지를 결정하는 과정은 다음과 같음

1. 패킷이 라우터에 도착
2. 라우터는 패킷의 IP 주소를 조사
3. 해당 목적지 주소를 이용하여 포워딩 테이블을 검색
4. 그 패킷을 출력 링크로 전송

<br/>

#### 라우팅 프로토콜(routing protocol)

그렇다면 포워딩 테이블은 어떻게 설정되는 것일까?

인터넷은 **자동으로 포워딩 테이블을 설정하는 데 이용되는** 여러 특별한 라우팅 프로토콜을 가지고 있다.

e.g., 각 라우터로부터 각 목적지까지 최단 경로를 결정 → 라우터에 포워팅 테이블을 설정하는 데에는 이 최단 경로 결과를 이용한다.

<br/>
<br/>
<br/>

## 1.3.2 회선 교환(circuit switching)

- 회선 교환 네트워크에서는 종단 시스템 간에 통신을 제공하기 위해  
  <b>경로상에서 필요한 자원(버퍼, 링크 전송률)</b>은 통신 세션(session) 동안에 확보 또는 `예약(reserve)` (↔︎ 패킷 교환 네트워크)
- 세션 메시지는 `온디맨드(on-demand) 방식`으로 자원을 요청하여 사용
- 따라서 통신 링크에 대한 접속을 위해 **큐에서 대기해야 할 수도 있음**

<br/>

- 연결 = `회선(circuit)` : 송신자와 수신자 간의 경로에 있는 스위치들이 해당 연결 상태를 유지해야 함

1. 송신자가 정보를 보내기 전, 네트워크는 송신자와 수신자 간의 **연결**을 설정
2. 네트워크가 회선을 설정할 때, 그 연결이 이루어지는 동안 **네트워크 링크에 일정한 전송률을 예약**
3. 주어진 전송률이 송신자-수신자 연결을 위해 예약되기 때문에, **송신자는 수신자에게** `보장된(guaranteed)` **일정 전송률로 데이터를 보낼 수 있음**

<br/>

#### 종단 간 연결(end-to-end connection)

<br/>

- 4개의 스위치와 4개의 링크로 구성된 회선 교환 네트워크, 각 링크는 4개의 회선을 가지므로 각 링크는 4개의 동시 연결 지원 가능

만약 두 호스트가 통신하고 싶을 때, 네트워크는 두 호스트 사이에 지정된 `종단 간 연결`을 설정

즉, 호스트 A가 호스트 B와 통신하기 위해서 네트워크는 먼저 **A의 링크와 B의 링크 각각에서 한 회선씩을 예약**

각 링크에 대하여 연결이 지속되는 동안 해당 연결은 링크 전체 전송 용량의 1/4를 얻음 (각 링크는 4개의 회선을 가지고 있기 때문)

<br/>

```
반대로, 한 호스트가 인터넷 같은 패킷 교환 네트워크를 통해 다른 호스트로 패킷을 보내고자 하는 경우에는 어떤 일이 발생할까?
```

회선 교환과 마찬가지로 패킷은 일련의 통신 링크를 통해 전송됨

하지만 회선 교환과는 다르게, **패킷 교환은 링크 자원을 예약하지 않고 네트워크로 보내짐**

<br/>

> 패킷 교환 네트워크는 일정한 시간 내에 데이터를 전달하는 것을 보장하지 않는다.

<br/>

#### 패킷 교환 대 회선 교환

**[ 패킷 교환 옹호자 ]**

- 주장
    1. 패킷 교환이 회선 교환보다 전송 용량의 공유에서 더 효율적이다.
    2. 패킷 교환이 회선 교환보다 더 간단하고 효율적이며, 구현 비용이 적다.
- 근거
    - 회선 교환에서 통신을 위해서는 자원이 항상 **각각의** 사용자에게 **예약**되어야만 한다.
    - 할당된 회선이 `비활용 기간(silent period)`에는 자원을 점유한 채로 놀게 되기 때문에 자원 이용률이 감소한다.
    - 즉, 회선 교환에서는 사용되지 않는 네트워크 자원(연결 경로상의 링크 주파수 대역이나 슬롯)은 **다른 진행 중인 연결이 대신해서 사용할 수 없기 때문에**  
      패킷 교환이 더 효율적이다.

<br/>

**[ 패킷 교환 반대자 ]**

- 주장 : 패킷 교환은 실시간 서비스에는 적당하지 않다.
- 근거 : 주로 큐잉 지연에서 발생하는 **종단 간의 지연** (불규칙적이고 예측할 수 없음)

<br/>

이를 확인해보기 위해서 간단한 예 두 가지를 살펴보자.

```
1. 사용자가 1 Mbps 링크를 공유한다고 가정하고, 각 사용자들은 활동 시간과 비활동 시간을 반복한다고 하자.
사용자는 전체 시간에서 10%만 활동하며 나머지 90% 시간에는 활동하지 않는다.
```

- 활동 시간 : 100 kbps의 일정 속도로 데이터를 생산할 때
- 비활동 시간 : 데이터를 생산하지 않을 때

<br/>

- `회선 교환`의 경우, 100 kbps가 항상 각각의 사용자에게 예약되어야 한다.  
TDM 회선 교환을 예시로, 초 프레임이 100 ms마다 10개 시간 슬롯으로 나뉜다고 한다면 각 사용자에게는 **한 프레임에 한 번의 시간 슬롯**이 할당된다.  
따라서 회선 교환 링크는 **동시에 10명(= 1 Mbps / 100 kbps)만 지원할 수 있다.**

<br/>

- `패킷 교환`의 경우, 한 특정 사용자가 활동을 하고 있을 확률은 10%이다.  
만약 10명 이하의 동시 사용자가 있다면 그 확률은 99.96%, 데이터의 통합 도착률은 1 Mbps(링크의 출력률)보다 작거나 같다.  
따라서 **10명 이상의 동시 사용자가 있다면 패킷의 통합 도착률이 링크의 출력 용량을 초과하기 때문에 출력 큐가 커지기 시작한다.**  
(이 큐는 통합 입력률이 1 Mbps 이하로 떨어질 때까지 커질 것이고, 이후에는 큐 길이가 줄어들기 시작할 것)

<br/>

10명 이상의 동시 사용자가 있을 확률은 0.04%로 굉장히 작으므로,  
**패킷 교환은 거의 항상 회선 교환과 대등한 지연 성능을 가지면서도** 거의 3배 이상의 사용자 수를 허용한다.

<br/>

---

<br/>

```
2. 10명의 사용자가 있다고 가정하자. 1번과 동일하게, 사용자는 1 Mbps 링크를 공유한다.
한 사용자가 한번에 1,000비트 패킷을 1,000개 생성하고 다른 사용자는 패킷을 생성하지 않는다.
```

<br/>

- `회선 교환`의 경우를 먼저 보자.  
TDM 회선 교환을 예시로, 한 프레임은 10개 슬롯으로 구성되고 각 슬롯은 1,000비트로 구성되었다면  
사용자는 데이터 전송을 위해 **한 프레임당 1개의 시간 슬롯만 사용할 수 있다.** 반면에 각 프레임에 남겨진 9개의 시간 슬롯은 쉬는 상태가 된다.  
따라서 사용자의 데이터 **100만 비트를 모두 전송하려면 10초가 걸린다.**

<br/>

- `패킷 교환`의 경우,  
패킷을 생성하는 다른 사용자가 없기 때문에 다중화가 요구되지 않고, 사용자는 1 Mbps의 링크가 가득 찰 때까지 패킷을 계속 보낼 수 있다.  
따라서 사용자의 데이터 100만 비트는 **1초 만에 모두 전송된다.**


<br/>

---

<br/>

앞의 두 가지 예에서 명확하게 볼 수 있듯, **패킷 교환이 회선 교환보다 성능이 우수**

따라서 오늘날의 전기통신 네트워크의 추세는 패킷 교환으로 전환되고 있음

<br/>

링크 전송률을 공유하는 두 방식의 가장 큰 차이점은 아래와 같이 정리할 수 있음

- 회선 교환 방식 : 요구에 관계없이 미리 전송 링크의 사용을 할당
- 패킷 교환 방식 : **요구할 때만** 링크의 사용을 할당

<br/>

## 1.3.3 네트워크의 네트워크

#### 접속 ISP

- `ISP(Internet Service Provider)` : 패킷 스위치와 통신 링크로 이루어진 네트워크
    1. 종단 시스템에게 다양한 네트워크 접속을 제공 (e.g., 가정용 초고속 접속, 고속 LAN 접속, 이동 무선 접속 등)
    2. CP(content provider)에게 인터넷 접속을 제공 → 웹 사이트나 비디오 서버를 인터넷에 직접 연결할 수 있게 됨


- 종단 시스템(PC, 스마트폰, 웹 서버 등)은 **접속 ISP를 통해 인터넷에 연결**
- 접속 ISP는 다양한 접속 기술(DSL, 케이블, FTTH, 와이파이, 셀룰러(이동 통신) 등)을 이용하여 유선 또는 무선 연결을 제공

<br/>

종단 사용자들과 콘텐츠 제공자들을 모두 접속 ISP로 연결하는 것은 말도 안 됨

**접속 ISP들이 서로 연결되어야만 하기 때문에** `네트워크의 네트워크(network of network)`가 탄생

<br/>

> 목표 : **모든 종단 시스템이 서로에게 패킷을 보낼 수 있도록** 접속 ISP를 연결하는 것

가장 간단한 방법은 각 접속 ISP를 직접 서로 다른 ISP와 연결하는 것

하지만 각 접속 ISP가 전 세계적으로 다른 접속 ISP와 수십만 개의 개별적인 통신 링크를 유지해야 하기 때문에,  
이런 그물망 설계는 접속 ISP에게 너무 많은 비용이 발생

<br/>

오늘날의 인터넷 네트워크 구조를 이해하기 위해 점진적으로 일련의 네트워크 구조를 만들어본다면?

<br/>

### 네트워크 구조 1

> 모든 접속 ISP를 **하나의 글로벌 통과(transit) ISP**와 연결한다.

- `글로벌 통과 ISP` : 라우터 + 전 세계에 이르고, 적어도 수십만 개의 접속 ISP와 가까운 곳에 있는 라우터를 갖는 통신 링크의 네트워크
- 글로벌 ISP가 이러한 확장된 네트워크를 구축하는 데는 매우 많은 비용이 든다.
- 글로벌 ISP는 이익을 얻기 위해 **각각의 접속 ISP에 연결을 위한 과금**을 부과한다.
    - 접속 ISP는 `고객(customer)`
    - 글로벌 ISP는 `제공자(provider)`

<br/>
<br/>

### 네트워크 구조 2

어느 회사가 수익을 내는 글로벌 ISP를 구축하고 운영한다면, 다른 회사가 자신의 글로벌 ISP를 구축하여 경쟁하는 것은 자연스러운 일이다.

이것이 네트워크 구조 2로 진화한다.

<br/>

> 수십만 개의 접속 ISP와 **다중의 글로벌 ISP**

- `2계층구조`
    - 상위층 : 글로벌 ISP 서비스 제공자가 존재
    - 하위층 : 접속 ISP가 존재
- **글로벌 ISP들은 서로 연결해야만 한다.**
- 서로 연결되지 않는다면 하나의 글로벌 ISP와 연결된 접속 ISP는 다른 글로벌 통과 서비스 제공자에 연결된 접속 ISP와 통신할 수 없다.

<br/>

#### 지역 ISP와 1계층 ISP

현실적으로 전 세계의 모든 도시에 존재하는 ISP는 없다.

대신, 어느 주어진 지역에서 그 지역에 있는 접속 ISP들이 연결하는 `지역(regional) ISP`가 존재하며, 각 지역 ISP는 `1계층(tier-1) ISP`들과 연결된다.  
*(실제로 존재하는 1계층 ISP는 전 세계적으로 모든 도시에 존재하지는 않는다.)*

<br/>
<br/>

### 네트워크 구조 3

> **다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP)** *→ 오늘날의 인터넷과 대략적으로 유사*

여러 경쟁적인 1계층 ISP들이 존재하며, 한 지역에 여러 경쟁적인 지역 ISP들이 존재할 수 있다.

더 복잡한 경우, 작은 지역 ISP들이 연결하는 좀 더 큰 지역 ISP들이 있을 수 있다.

<br/>

이런 계층구조에서의 과금은 크게 다음과 같이 진행된다.

고객 ISP는 글로벌 인터넷 연결성(interconnectivity)을 얻기 위해 서비스 제공 ISP에게 요금을 지불하기 때문에  
"각 레벨에는 고객-제공자 관계가 존재한다"고 할 수 있다.

1. 각각의 **접속 ISP**는 자신이 연결하는 **지역 ISP에게** 요금을 지불한다.
2. 각 **지역 ISP**는 자신이 연결하는 **1계층 ISP에게** 요금을 지불한다.
3. 1계층 ISP는 계층구조의 최상위에 있기 때문에 아무에게도 요금을 지불하지 않는다.

<br/>
<br/>

### 네트워크 구조 4

> 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + **PoP + 멀티홈 + 피어링 + IXP**

<br/>

오늘날의 인터넷과 좀 더 유사한 네트워크를 구축하기 위해서는 네트워크 구조 3에 아래 4가지 항목들을 포함해야 한다.

- `PoP(Points of Presence)`
    - 단지 제공자의 네트워크 내에 있는(같은 위치에 존재하는) 하나 혹은 그 이상의 라우터 그룹
    - 최하위(접속 ISP) 계층을 제외한 모든 계층에 존재하며, **고객 ISP가 제공자 ISP에 연결될 수 있다.**
    - 고객 네트워크가 제공자의 PoP에 연결되기 위해,  
      고객은 자신의 라우터 중 하나를 PoP에 있는 라우터에 직접 연결하도록 **고속 링크를 제3자(third-party) 통신 서비스 제공자로부터 임대할 수 있다.**


- `멀티홈(multi-homing)`
    - **둘 혹은 그 이상의 제공자 ISP에 연결하는 것**
    - e.g., 한 접속 ISP가 2개의 ISP에 연결, 2개의 지역 ISP와 함께 하나의 1계층 ISP에 연결
    - 1계층 ISP를 제외한 모든 ISP는 멀티홈을 선택할 수 있다.
    - 한 ISP가 멀티홈을 하면 서비스 제공자 중 하나가 연결되지 않더라도 인터넷으로 패킷을 계속 송수신할 수 있게 된다.


- `피어링(peering)`
    - 고객 ISP가 서비스 제공 ISP에게 지불하는 요금을 줄이기 위해 **인터넷 계층구조의 같은 계층에 있는 가까운 ISP들은 피어링할 수 있다.**  
      (두 ISP가 피어링하면 일반적으로 서로 요금을 지불하지 않음)
    - 즉, 이들 간에 송수신되는 모든 트래픽을 **상위 계층 ISP를 통하지 않고 직접 송수신할 수 있도록** 자신들의 네트워크를 서로 직접 연결하는 것이다.
    - 1계층 ISP들도 서로 피어링할 수 있다.


- `IXP(Internet Exchange Point)`
    - 다중의 ISP들이 서로 피어링할 수 있는 만남의 장소
    - 일반적으로 교환기를 갖춘 독자적인 빌딩에 존재한다.

<br/>
<br/>

### 네트워크 구조 5

> 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + PoP + 멀티홈 + 피어링 + IXP + **콘텐츠 제공 네트워크**

<br/>

이는 2012년의 인터넷을 기술하며, **구글**이 이러한 콘텐츠 제공자 네트워크 주도하는 한 예이다.

- 구글 데이터 센터는 모두 구글의 사설 TCP/IP 네트워크를 통해 연결되어 있으며, 이 네트워크는 전 세계를 연결하며 공중 인터넷과는 분리되어 있다.
- **구글 사설 네트워크는 구글 서버로 오가는 트래픽만 전달한다.**
- 즉, 하위 계층 ISP들과 피어링을 함으로써(그들과 직접 연결하거나 IXP에서 그들과 연결함으로써) 인터넷의 상위 계층을 ‘`우회(bypass)`’하고 있다. 

<br/>

- 많은 접속 ISP는 여전히 1계층 네트워크를 통해서만 도달할 수 있기 때문에  
  구글 네트워크도 1계층 ISP들과 연결하고 그들과 교환하는 트래픽에 대해 이 ISP들에게 요금을 지불한다.
- 콘텐츠 제공자들이 자신의 네트워크를 구축함으로써 얻는 이점
    - 상위 계층 ISP들에게 지불하는 요금을 줄일 수 있다.
    - 최종 사용자들에게 자신들의 서비스가 궁극적으로 어떻게 전달되는지에 대한 더 많은 통제권을 가질 수 있다.

<br/>

---

<br/>

최종 정리하자면 다음과 같다.

> 오늘날의 <b>인터넷(네트워크의 네트워크)</b>는 12개 정도의 1계층 ISP들과 수십만 개의 하위 계층 ISP들로 구성되어 있다.

- 하위 계층 ISP들은 상위 계층 ISP들과 연결하고, 상위 계층 ISP들은 서로 연결한다.
- 사용자와 콘텐츠 제공자는 하위 계층 ISP 고객이고, 하위 계층 ISP들은 상위 계층 ISP들이 고객이다.
- 최근에 주요 콘텐츠 제공자도 자신의 네트워크를 구축했고 가능한 곳에서 하위 계층 ISP들과 직접 연결한다.

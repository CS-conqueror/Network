# 6.3 다중 접속 링크와 프로토콜

<br>

## 다중 접속 링크와 다중 접속 프로토콜

---

### 브로드캐스트 링크
> 하나의 공유된 브로드캐스트 채널에 다수의 송신 노드와 수신 노드가 연결

<br>

### 충돌
> 2개 이상의 노드가 동시에 프레임을 전송할 때 수신자가 여러 개의 전송된 프레임을 받음

- 충돌이 발생하면 수신 노드는 전송된 프레임이 어느 송신 노드에서 왔는지 구별할 수 없으므로 프레임의 의미를 파악할 수 없음
- 충돌과 관련된 프레임은 손실되고 브로드캐스트 채널은 충돌 기간만큼 낭비

<br>

### 다중 접속 프로토콜
> 브로드 캐스트 채널로 보내는 노드들의 전송을 조정하는 프로토콜

 - 이상적인 특성(다중 접속 프로토콜이 반드시 아래의 모든 특성을 만족하는 것은 아님)
    * 단 하나의 노드만 전송할 데이터가 있을 때의 처리율은 R bps
    * M개의 노드가 전송할 데이터가 있을 때의 각 노드의 평균 처리율은 R/M bps
    * 마스터 노드가 없고 분산되어 있음
    * 단순해서 구현 비용이 적음
 - 종류 : 채널 분할 프로토콜, 랜덤 접속 프로토콜, 순번 프로토콜

<br>

## 채널 분할 프로토콜

---

<p align="center"><img width="300" alt="TDM FDM" src="https://user-images.githubusercontent.com/76640167/214252177-bf3b863e-80dd-4ae6-a463-0c2c67af4e4e.png">


### 주파수 분할 다중화(FDM) : 채널의 공간을 분리
> R bps의 채널을 다른 주파수(R/N의 대역폭을 가진)로 나눠서 각 주파수를  N개 노드 중 하나에게 할당

- 충돌을 피하고 N개 노드에게 균등하게 대역폭을 분할
- 전송할 패킷이 있는 노드가 하나라도 R/N 대역폭만 사용함

<br>

### 시분할 다중화(TDM) : 채널의 사용 시간을 분리
> 시간을 시간 프레임으로 나누고 각 시간 프레임을 N개의 시간 슬롯으로 나눠 자신에게 할당된 시간 슬롯 동안 패킷 전송

- 충돌을 제거하고 모든 노드는 프레임 시간 동안 R/N bps의 전송률을 가짐
- 전송할 패킷이 있는 노드가 하나라도 노드 전송률은 평균 R/N으로 제한
- 노드가 채널이 비어 있어도 자신의 차례를 항상 기다려야 함

<br>

### 코드 분할 다중 접속(CDMA) : 데이터 비트를 구분
> 각기 다른 코드를 각 노드에 할당하여 수신자가 송신자의 코드를 가지고 있어 수신된 데이터 비트를 구분

- 여러 노드들이 패킷을 동시에 전송 가능

<br>

## 랜덤 접속 프로토콜

---

> 충돌 발생시 각 노드는 충돌 없이 전송될 때까지 자신의 랜덤 지연 시간만큼 대기 후 자신의 프레임을 충돌 없이 전송될 때까지 재전송

- 노드는 항상 채널의 최대 전송률 R bps로 전송

<br>

### 슬롯 알로하

<p align="center"><img width="300" alt="슬롯 알로하" src="https://user-images.githubusercontent.com/76640167/214252171-bb6a376c-f16c-4984-91a6-6360d106db1e.png">

- 과정
  1) 각 노드는 슬롯의 시작지점을 알 수 있도록 동기화 되어 있고 각 슬롯의 시작점에서만 프레임을 전송
  2) 노드는 전송할 프레임이 있으면 다음 슬롯이 시작할 때 까지 기다렸다가 프레임을 전송
  3) 충돌이 없다면 노드는 성공적으로 프레임을 전송
  4) 충돌이 검출되면 충돌 없이 전송될 때까지 확률 p로 해당 프레임을 다음 슬롯에서 재전송

- 특징
   * 채널의 최대 전송률 R bps로 프레임 전송
   * 각 노드가 자신의 전송을 결정하므로 분산
   * 단순한 프로토콜
   * 활성 노드가 많으면 충돌로 인해 일부 슬롯이 결국 낭비
   * 확률에 맡기기에 일부 슬롯이 전송 없이 빌 수 있음

- 효율성
   * N개 활성 노드가 있을 때 효율은 N * P * (1-p)<sup>N-1
   * 최대 효율은 1/e = 0.37, 37%의 슬롯만 낭비되지 않음

<br>

### 알로하

<p align="center"><img width="300" alt="알로하" src="https://user-images.githubusercontent.com/76640167/214252168-877732ca-dd9d-4dba-8dcd-253213b0a71c.png">

 - 슬롯 알로하와 달리 프레임이 도착하면 즉시 브로드캐스트 채널로 전송
 - 충돌이 발생하면 노드는 확률 p로 즉시 재전송하거나 대기, 대기 후 다시 확률 p로 전송 혹은 대기
 - 노드가 성공적인 전송을 할 확률은 P * (1 - P)<sup>2 * (N - 1)
 - 최대 효율은 1/(2e)로 슬롯 알로하의 절반

<br>

### CSMA(carrier sense multiple access)
 #### 캐리어 감지
 > 노드는 전송하기 전에 채널을 확인하고 전송 중이 아니라면 채널로 전송

#### 채널 전파 지연
 > 신호가 채널의 한쪽 끝에서 다른 쪽 끝으로 전파되는 데 걸리는 시간

 - 채널 전파 지연에 의해 프레임이 전송되는 도중 특정 구역에 도달하기 전에 다른 프레임이 전송되면 충돌이 발생
 - 전파 지연이 길수록 캐리어 감지 노드가 감지할 수 없는 경우가 증가

<br>

### CSMA/AD(carrier sense multiple access / collision detection)
 #### 충돌 검출
 > 송신 노드가 다른 노드가 방해프레임을 전송하고 있음을 검출하면 랜덤 시간 동안 대기 후 전송

 - 시간 간격이 크거나 충돌하는 노드가 적을 때는 시간 간격을 적게하는 것이 유리
 - 시간 간격이 적거나 충돌하는 노드가 많을 때는 시간 간격을 크게하는 것이 유리

#### 이진 지수적 백오프 알고리즘
> 충돌을 n번 경험한 프레임을 전송할 때 노드는 0에서 2<sup>n - 1 중 랜덤한 K값을 선택

- 효율성
   * d<sub>prop</sub>는 신호 에너지가 두 어댑터 사이에 전파되는 데 걸리는 최대 시간
   * d<sub>trans</sub>는 최대 크기의 이더넷 프레임을 전송하는데 걸리는 시간
   * 효율 = 1 / 1 + (5 * d<sub>prop</sub> / d<sub>trans</sub>)
   * d<sub>prop</sub>이 0에 가까울수록 d<sub>trans</sub>가 클수록 효율은 1에 가까워짐
 
 <br>

 ## 순번 프로토콜

 ---

 - 알로하와 CSMA 프로토콜은 M개의 노드가 활성이면 각 노드가 약 R/M bps의 처리율을 갖는 특성이 없음
 - 순번 프로토콜은 이 특성을 만족하기 위해 개발

 ### 폴링 프로토콜
 > 마스터 노드가 각 노드에 최대로 보낼 수 있는 프레임 수에 대한 정보를 지닌 메서드를 전송

 - 빈 슬롯이 없어 높은 효율을 제공
 - 모든 노드에 전송 가능한 프레임 수를 보내야 하므로 폴링 지연이 발생, 활성 노드가 한 개라도 R bps보다 작은 전송률로 전송
 - 마스터 노드가 고장나면 전체 채널이 동작 불가

<br>

 ### 토큰 전달 프로토콜
 > 토큰이 노드 간에 순서대로 전달 되며 전송할 프레임이 있을 때만 토큰을 잡고 전송 후 토큰을 다음 노드로 전달

 - 분산 방식이며 효율이 높음
 - 노드 하나가 실패하면 전체 채널이 동작 불가
 - 노드가 토큰을 놓지 못하면 토큰 회복 절차가 실행되어야 함

<br>

## DOCSIS:케이블 인터넷 접속을 위한 링크 계층 프로토콜
<p align="center"><img width="300" alt="DOCSIS" src="https://user-images.githubusercontent.com/76640167/214252151-206f9c41-58d2-4547-915a-25b1389c9e20.png">

- DOCSIS는 하향 채널과 상향 채널을 FDM을 사용하여 나눔
- CMTS(케이블 모뎀 종단 시스템)은 하나 뿐이므로 하향 채널에서 다중 접속 문제는 발생하지 않음
- 상향 채널은 TDM으로 나누어져 각 케이블 모뎀이 CMTS로 전송할 수 있는 미니슬롯들로 구성
- 미니슬롯 할당을 위해 케이블 모뎀은 미니슬롯 요청 프레임을 CMTS에 전송
- 미니슬롯 요청 프레임은 충돌 가능, 응답을 케이블 모뎀이 수신하지 못하면 충돌됐다고 추정하고 재전송(이진 지수적 백오프)
- 케이블 모뎀은 미니슬롯 요청 프레임 슬롯으로도 데이터 프레임 전송 가능능

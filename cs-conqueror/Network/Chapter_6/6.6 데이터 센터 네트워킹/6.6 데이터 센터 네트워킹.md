# 6.6 데이터 센터 네트워킹

데이터 센터는 인터넷에 연결되어 있을 뿐만 아니라 내부 호스트들 간 상호연결을 위해 자체 **데이터 센터 네트워크**를 갖고 있음

데이터 센터는 세 가지 목적을 수행
- 웹 페이지, 검색 결과, 전자 메일, 스트리밍 비디오와 같은 콘텐츠를 사용자에게 제공
- 검색 엔진을 위한 분산 인덱스 계산과 같은 특정 데이터 처리 작업이 가능한 대량 병렬 컴퓨팅 인프라스트럭처 역할
- 다른 회사에게 **클라우드 컴퓨팅** 을 제공

## 6.6.1 데이터 센터 구조

데이터 센터에서 작업을 수행하는 것은 **호스트**
- 호스트는 피자 박스 모양의 **블레이드**라고도 불리며, CPU, 메모리, 디스크 저장창지를 갖고 있는 범용 호스트
- 데이터 센터의 호스트들은 20~40대의 블레이드를 적재할 수 있는 랙(rack)에 적재
- 랙의 맨 위에는 **TOR(Top of Rack)** 스위치라고 불리는 스위치 존재
- TOR 스위치는 랙에 있는 호스트들을 연결해주고 데이터 센터의 다른 스위치들과 연결
- 랙에 있는 호스트는 네트워크 인터페이스 카드를 통해 TOR 스위치에 연결되고, TOR 스위치는 다른 스위치로 연결될 수 있는 포트들을 추가로 소유
- 호스트는 데이터 센터 내부에서 사용되는 자신만의 IP 주소를 할당 받음

데이터 센터 네트워크는 외부 클라이언트와 내부 호스트 사이의 트래픽과 내부 호스트 간의 트래픽 등 두 종류의 트래픽을 지원
- **경계 라우터(border router)** : 외부 클라이언트와 내부 호스트 간 트래픽 플로우를 처리하기 위해 데이터 센터 네트워크를 공중 인터넷으로 연결해줌
- **데이터 센터 네트워크 설게**는 컴퓨터 네트워킹 연구에서 중요한 분야가 되고 있음

### 로드 밸런싱

클라우드 데이터 센터는 여러 애플리케이션을 동시에 제공
- 외부 클라이언트로부터의 요청 지원 위해 애플리케이션에는 공용 IP 주소가 할당되며, 클라이언트는 이 IP 주소로 요청을 보내고 이 IP 주소로부터 응답을 받음
- 데이터 센터에서는 외부로부터 요청이 들어오면 로드 밸런서로 보내고, 로드 밸런서는 요청을 호스트로 분배하고 호스트의 현재 부하 상태에 따라 호스트 간의 부하를 균등하게 함
- 대규모 센터의 경우 여러 대의 로드 밸런서를 갖고 있으며, 각 로드 밸런서는 특정 클라우드 애플리케이션을 위해 사용
- 목적지 포트 번호(4계층)를 보고 결정하기 때문에 '4계층 스위치'라고도 불림
- 호스트 간 로드 밸런싱 수행 외 호스트의 공용 외부 IP 주소를 내부 IP 주소로 변환해주고 클라이언트 쪽(역방향)으로 가는 패킷의 내부 IP 주소를 공용 외부 IP 주소로 변환해주는 NAT와 유사한 기능 제공
    <br>
    => 내부 네트워크 구조를 숨기고 클라이언트가 호스트와 직접 상호작용하지 못하게 함으로써 보안을 제공

### 계층 구조

<p align="center"><img width="700" alt="데이터 센터" src="https://user-images.githubusercontent.com/76640167/214875512-04558954-375e-44f4-89e1-71d25703126b.png">

수십만 대의 호스트까지 확장하기 위해 데이터 센터는 그림의 토폴로지처럼 라우터와 스위치의 계층 구조를 채택
- 계층 구조의 최상단에서는 경계 라우터가 접속 라우터들에 연결
- 접속 라우터 아래에는 세 단의 스위치 존재
- 접속 라우터는 최상단 스위치에 연결되고, 최상단 스위치는 여러 개의 두 번째 단 스위치들과 로드 밸런서에 연결
- 모든 링크는 링크 계층 및 물리 계층 프로토콜로 이더넷을 사용

<br>

클라우드 애플리케이션 제공자 입장에서는 애플리케이션의 가용성을 높게 유지하는 것이 중요하기 때문에 데이터 센터 설계에 여분의 네트워크 장비와 링크를 포함
<br>

기존의 계층적 구조는 확장선 문제를 해결하기는 하지만 호스트-호스트 간 용량을 제한하는 문제가 있음
- 해결 방안에는 세 가지가 존재
    - 고속 스위치와 라우터를 사용 => 비용 증가
    - 2단 또는 1단 스위치를 경유하는 랙 간 통신이 최소화되도록 서로 관련된 서비스와 데이터를 가능한 같은 곳에 위치 => 계산과 서비스 융통성 있게 배치할 수 없음
    - TOR 스위치들과 2단 스위치들 간, 2단 스위치들과 1단 스위치들 간 연결성 증가시키기
        - 단 간의 연결성을 증가시킴으로써 스위치 간 용량 및 신뢰정 증가의 이득을 얻을 수 있음

<br>

데이터 센터 네트워크의 단 간 연결성이 증가됨으로써 다중 경로 라우팅이 우선적으로 적용되게 됨

## 6.6.2 데이터 센터 네트워킹 동향

데이터 센터 네트워킹은 비용 감소, 가상화, 물리적 제약사항, 모듈화, 커스터마이징 등을 고려하면서 빠르게 발전

### 비용 감소
확장 및 배치의 수월, 데이터 센터 비용 감소, 지연과 처리율 향상을 위해 계속해서 새로운 형태의 데이터 센터 네트워크 설계 방법 적용
<br>

계층적으로 단을 구성하여 데이터 센터 호스트들을 상호연결해주는 구조
- 단일 크로스바 스위치와 비교했을 때 출발지와 도착지의 다중 경로를 가짐
- 용량 증가 및 신뢰정 증가의 장점
<br>

데이터 센터 상호연결 네트워크
- 다수의 소규모 스위치들로 구성
- 클로 네트워크 : 다중 스위치 계층구조의 상호연결 네트워크

### 중앙 집중형 SDN 제어 및 관리

데이터 센터는 단일 기관에 의해 관리되기 때문에 대규모 데이터 센터 운영자들은 SDN과 같은 논리적 중앙 집중형 제어라는 개념을 쉽게 받아들이게 됨

### 가상화

가상화는 클라우드 컴퓨팅과 데이터 센터 네트워크의 발전에 많은 영향을 끼침
<br>

가상 머신(Virtual Machine)은 소프트웨어를 실행하는 애플리케이션을 물리 하드웨어로부터 분리

### 물리적 제약사항

광역 인터넷과 달리 데이터 센터 네트워크는 고용량, 초 저지연 환경에서 동작.<br>
따라서, 데이터 센터의 경우 버퍼 크기가 작으며 TCP 등과 같은 혼잡 제어 프로토콜 효과적 작동 불가<br>
스케줄링 이론을 적용함으로써 플로우 스케줄링과 전송률 제어를 분리해서 높은 링크 효율을 유지하면서도 매우 단순하게 혼잡 제어를 할 수 있는 기법들이 개발됨

### 하드웨어 모듈화와 커스터마이징

선박 컨테이너 기반의 모듈화된 데이터 센터(MDC, modular data center)
<br>

대규모 클라우드 제공자가 네트워크 어댑터, 스위치, 라우터, TOR, 소프트웨어, 네트워킹 프로토콜 등 데이터 센터에 있는 모든 것을 계속해서 구축 혹은 커스터마이징
<br>

근처 건물들에 데이터 센터를 복제함으로써 '가용 구역'을 확보해 신뢰성을 높임

# 6.5 링크 가상화 : 링크 계층으로서의 네트워크
링크 : 서로 통신하는 2개의 호스트를 연결하는 물리적인 선
<br>

인터넷이 전화 네트워크를 오버레이하는 것과 마찬가지로, 인터넷을 오버레이하기 위해 오버레이 네트워크는 인터넷을 오버레이 노드 간의 연결을 제공하는 방법으로 간주
<br>

MPLS
- 회선 교환 네트워크와 달리, 패킷 교환, 가상 회선 네트워크
- 자체적인 패킷 형식과 전달 방식을 사용, 네트워크 계층이나 링크 계층에 해당
- But, 인터넷 관점에서 MPLS는 전화 네트워크나 스위치 이너뎃처럼 IP 장치를 상호 연결하는 데 사용되는 링크 계층 기술로 다뤄짐

## 6.5.1 다중 프로토콜 레이블 스위칭(MPLS)
MPLS(Multiprotocol Label Switching)은 가상 회선 네트워크의 주요 개념인 고정 길이 레이블을 도입함으로써 IP 라우터의 전달 속도를 향상하려고 한 산업계의 노력으로부터 발전
<br>

MPLS의 목표는 고정 길이 레이블과 가상 회선을 기반으로 데이터그램을 전달하기 위해 목적기 기반 IP 데이터그램 전달 인프라스트럭처를 포기하는 것이 아니라, 가능한 경우에 데이터그램을 선택적으로 레이블링해서 라우터로 하여금 고정 길이 레이블을 기반으로 데이터그램을 전달할 수 있도록 목적기 기반 IP 데이터그램 전달 하부구조를 확장하는 것
<br>

중요한 것은 **이 기술이 IP 주소 체계와 라우팅을 사용하는 IP와 긴밀하게 동작** 한다는 것
<br>

MPLS 가능(MPLS-capable) 라우터에 의해 처리되는 링크 계층 프레임 형식

<p align="center"><img width="700" alt="MPLS 헤더" src="https://user-images.githubusercontent.com/76640167/214874099-42e288e6-687a-46b6-a313-546fcdeed767.png">

- 그림은 MPLS 가능 장치들 간 전달되는 링크 계층 프레임이 2계층 헤더와 3계층 헤더 사이에 작은 MPLS 헤더를 가짐을 보여줌

- cf- 2계층 헤더 : 링크 계층 헤더 / 3계층 헤더 : 네트워크 계층 헤더 
     - 망계층(계층 3)의 헤더와 데이타링크 계층(계층 2)의 헤더 간에,
     - "MPLS 헤더"(이를 MPLS Label이라 부름)가 있어, 
     - 이 라벨에 의해, 고속의 하드웨어 스위칭이 가능토록 함
     - 즉, Layer 2 에서 Forwarding 및 Layer 3 에서 Routing을 함

- MPLS 헤더에는 레이블, 실험을 위해 예약된 3개의 비트, 일련의 '스택된' MPLS 헤더들의 끝을 나타내는 1개의 S 비트, TTL 필드가 있음
- MPLS 향상(MPLS-enhanced) 프레임이 MPLS 가능 라우터들 사이에서만 전송될 수 있음을 알 수 있음 
    - => MPLS가 가능하지 않은 라우터는 IP 헤더 자리에 MPLS 헤더가 있으면 혼란을 느낌
- MPLS 가능 라우터는 MPLS 레이블을 포워딩 테이블에서 찾아 적당한 출력 인터페이스로 데이터그램을 전달하여 MPLS 프레임을 전달하므로 종종 **레이블 스위치 라우터(lable-switched router)** 라고 부름
    -  => 그러므로 MPLS 가능 라우터는 목적지 IP 주소를 꺼내 볼 필요도 없고, 포워딩 테이블에서 최장 프리픽스 대응을 찾을 필요도 없음

MPLS 가능 라우터 간 상호동작

<p align="center"><img width="700" alt="MPLS 네트워" src="https://user-images.githubusercontent.com/76640167/214874093-edf53d76-44dd-4d7e-b228-2c8df445c76b.png">

- 스위치 랜 또는 ATM 네트워크가 IP 장치들을 연결해주는 것과 같이, IP 장치 R5, R6, A, D가 MPLS 인프라스트럭처를 통해 서로 연결되는 것이 나타나있음
- 스위치 랜 또는 ATM 네트워크처럼 MPLS 가능 라우터인 R1 ~ R4는 ``패킷의 IP 헤더를 건드리지 않고`` 동작함
<br>

MPLS의 장점
- MPLS가 제공하는 트래픽 관리 기능
    - 5장에서 다룬 표준 IP 라우팅 프로토콜은 최소 비용 경로 하나만 지정하지만, MPLS는 표준 IP 라우팅 프로토콜을 사용해서는 불가능한 경로를 이용해 패킷을 전달하는 능력을 제공
    - MPLS를 사용하여 트래픽 엔지니어링을 제공하는 간단한 하나의 방식
- MPLS 전달 경로의 빠른 복구를 위해 사용
    - 링크 고장 시 미리 계산된 복구 경로로 트래픽을 재배정
- **가상 사설 네트워크(virtual private network, VPN)** 를 구현하는 데도 사용
    - ISP는 MPLS 가능 네트워크를 사용해서 고객의 다양한 네트워크를 연결 할 수 있음

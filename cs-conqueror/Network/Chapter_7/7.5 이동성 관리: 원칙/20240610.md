# 7.5 이동성 관리: 원칙

<br>

## 장치 이동성: 네트워크 계층의 관점

---

### 다양한 이동성 스펙트럼
 1. 이동 중에는 전원을 끄고 접속 네트워크 간 장치 이동
 2. 하나의 동일한 무선 접속 네트워크 안에서 장치 이동
 3. 진행 중인 연결을 유지하며 동일 통신 사업자 네트워크 내에서 장치 이동
 4. 진행 중인 연결을 유지하며 여러 통신 사업자 네트워크 간의 장치 이동

 - 1,2번은 네트워킹 관점에서 장치가 이동중인 것이 아니고 3,4번은 이동중인 것

<br>

### 핸드오버
> 하나의 AP 혹은 기지국에서 다른 AP 혹은 기지국으로 데이터그램을 책임지고 전달

- 단일 네트워크 사업자의 접속 네트워크 내 : 사업자가 자체적으로 핸드오버 처리
- 여러 사업자 네트워크 간 로밍 : 사업자들은 협력하여 핸드오버 처리

<br>

## 홈 네트워크 및 방문 네트워크로의 로밍

---

### 홈 네트워크 : 본가
> HSS(Home Subscriber Service)가 가입자들에 대한 다양한 정보를 저장

#### 장점
 - 해당 장치에 대한 정보를 제공할 수 있는 단일한 위치를 제공
 - 로밍 중인 이동 장치와의 통신을 위한 조정 지점의 역할

<br>

### 방문 네트워크 : 자취방
> 이동 장치가 홈 네트워크 이외에 연결된(로밍중인) 다른 셀룰러 네트워크

<br>

## 이동 장치로의 직접 라우팅과 간접 라우팅

---

### 이동 장치의 고유한 식별자
 - 4G LTE 셀룰러 네트워크 : ISMI(International Mobile Subscriber Identity)와 관련된 전화번호
 - 인터넷 사용자 : 홈 네트워크의 주소 범위에 있는 영구적인 IP 주소

### 기존 IP 주소 인프라 활용
 1. 방문 네트워크는 매우 구체적인 주소를 광고함으로 특정 이동 장치가 자신의 네트워크에 존재한다는 사실을 모든 네트워크에 알림
 2. 인접 네트워크들은 라우팅 정보 및 포워딩 테이블을 갱신하는 BGP(Border Gateway Protocol) 절차를 사용해 네트워크 전체에 이 정보를 전파
 3. 이동 장치가 새로운 방문 네트워크로 이동하면 새로운 방문 네트워크는 이동 장치에 대한 새로운 경로를 광고하고 이전의 방문 네트워크는 이동 장치에 대한 라우팅 정보를 철회

#### 단점
 - 네트워크 라우터는 수십억 개의 이동 장치에 대한 포워딩 테이블 항목을 유지, 관리
 - 로밍할 때마다 장치 관련 항목을 갱신

#### 해결 방안 : 이동 장치의 홈 네트워크를 이용
- 영구적인 IP 주소 : 홈 네트워크와 연결된 IP 주소
- 새로운 IP 주소 : NAT(Network Address Translation)주소와 같은 주소 활
  * NAT 주소는 이동 장치로 향하는 데이터그램이 방문 네트워크의 NAT 게이트웨이 라우터에 도달하면 NAT 주소 변환을 거쳐 해당 이동 장치로 전달

<br>

### 이동 장치로의 간접 라우팅
> 통신자는 데이터그램의 목적지 주소를 이동 노드의 영구적인 주소로 설정한 후 네트워크로 전송

<p align="center"><img width="700" alt="간접 라우팅" src="https://user-images.githubusercontent.com/86337233/216779484-23edff49-e8d4-4f43-b5ab-5acf67f50262.png">

#### 간접 라우팅 과정 : 통신자가 이동 장치에 데이터 그램 전송
 1. 홈 네트워크는 게이트웨이는 데이터그램을 캡슐화(홈 네트워크를 통해 전달되었음을 감추기 위해)하여 HSS를 통하여 이동 장치가 있는 방문 네트워크를 결정하고 방문 네트워크의 게이트웨이 라우터로 전달
 2. 방문 네트워크 게이트웨이 라우터는 캡슐화를 해제하고 데이터그램을 복원하여 이동 장치로 전달

<br>

#### 이동 장치가 통신자에게 데이터그램을 보내는 방법

<p align="center"><img width="700" alt="간접 라우팅 2" src="https://user-images.githubusercontent.com/86337233/216779488-751ef052-38f3-41ad-a08c-2b5476654d22.png">

 1. 데이터그램을 홈 게이트웨이 라우터로 터널링하여 통신자에게 전달
 2. 데이터그램은 방문 네트워크에서 통신자로 직접 전달

<br>

#### 이동성 지원에 필요한 네트워크 계층 프로토콜
 - `이동 장치에서 방문 네트워크로의 프로토콜` : 이동 장치는 방문 네트워크와 결합하며 떠날 때는 결합을 해제
 - `방문 네트워크에서 홈 네트워크로의 HSS 등록 프로토콜` : 방문 네트워크는 홈 네트워크의 HSS에 이동 장치의 위치를 저장, HSS 정보를 활용하여 장치 인증 수행
 - `홈 네트워크 게이트웨이와 방문 네트워크 게이트웨이 라우터 사이의 데이터그램 터널링 프로토콜` : 송신 측은 통신자의 데이터그램을 캡슐화하여 목적지로 전달하고 수신 측 게이트웨이 라우터에서 캡슐화 해제 및 NAT 변환을 거쳐 원래 데이터그램을 이동 장치로 전달

#### 연결 중단에 따른 데이터그램의 손실
 - 기존 방문 네트워크의 연결을 끊고 새로운 방문 네트워크와 결합하는 시간 간격이 짧으면 데이터그램의 손실은 거의 없음
 - 무손실 통신이 필요한 경우 상위 계층 프로토콜에 의해 데이터그램 손실은 복구 가능(데이터 손실의 원인이 네트워크 혼잡인지 장치의 이동성인지 상관없음)

<br>

### 이동 장치로의 직접 라우팅

#### 삼각 라우팅 문제
> 이동 장치를 목적지로 하는 데이터그램은 더 효율적인 경로가 있음에도 홈 네트워크로 전달된 다음 방문 네트워크로 전달

#### 직접 라우팅 과정 : 통신자가 이동 장치에 직접 데이터그램 전달

<p align="center"><img width="700" alt="직접 라우팅" src="https://user-images.githubusercontent.com/86337233/216779489-175e7cd6-5e92-4078-9642-c31c1ea54269.png">

 1. 이동 장치의 홈 네트워크에 질의함으로 이동 장치가 위치한 방문 네트워크를 발견
 2. 통신자는 데이터그램을 이동 장치의 방문 네트워크로 직접 터널링해서 전달

#### 필요 프로토콜
 - 이동 사용자 위치 파악 프로토콜(HSS에 방문 네트워크를 질의하는)이 필요
 - 이동 장치가 이동할 때마다 통신자를 미리 갱신해주는 프로토콜(HSS에 한번만 질의하기 때문)

   

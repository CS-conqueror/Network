# 실전에서의 이동성 관리

<br>

## 4G/5G 네트워크에서의 이동성 관리

---

<p align="center"><img width="600" alt="이동성 시나리오" src="https://user-images.githubusercontent.com/86337233/216887701-4c7e6f31-d870-4879-8be4-9bb5396a54e3.jpg">

### 단계
 1. 기지국 결합 : 이동 장치는 기지국에 대한 많은 정보를 바탕으로 결합할 기지국을 선택하고 해당 기지국과 제어 신호 채널을 초기 설정
 2. 이동 장치에 대한 LTE 네트워크 요소의 제어 평면 구성
   * MME(Mobility Management Entity)는 IMSI 및 이동 장치에서 제공한 정보를 사용하여 해당 가입자에 대한 인증, 암호화, 가용한 네트워크 서비스 정보를 검색, 상호 인증 프로세스는 방문 네트워크가 이동 장치의 ID에 대해 확신하고 장치가 연결 중인 네트워크를 인증할 수 있는지 확인
   * MME는 이동 장치가 현재 방문 네트워크에 존재함을 홈 네트워크에 있는 HSS에 알리고 HSS는 데이터베이스를 갱신
   * 기지국과 이동 장치는 둘 사이에 설정될 데이터 평면 채널에 대한 매개변수를 선택
 3. 이동 장치에 대한 포워딩 터널의 데이터 평면 구성

<p align="center"><img width="600" alt="터널링" src="https://user-images.githubusercontent.com/86337233/216887710-4548ee72-10d6-45bd-8f32-2d6f666a7339.jpg">

   * 기지국과 방문 네트워크의 서빙 게이트웨이 사이의 터널, 서빙게이트웨이와 이동 장치의 홈 네트워크에 있는 PDN 게이트웨이 라우터 사이의 터널 2개를 설립
   * 4G LTE는 대칭 간접 라우팅을 구현
   * 이동 장치에서 오고 가는 모든 트래픽은 장치의 홈 네트워크를 통해 터널링
   * GPRS 터널링 프로토콜을 사용, 헤더의 TEID(Tunnel Endpoint ID)는 데이터그램이 속한 터널을 나타냄, 터널 종단점 간에 GTP에 의해 여러 개의 흐름이 다중화 및 역다중화
   * 홈 네트워크 내에서만 이동성을 갖는 경우와 비교하여 서빙 게이트는 이동 장치와 동일한 네트워크에 공존하지만, PDN 게이트웨이는 이동 장치와 다른 네트워크에 있을 수 있다는 차이가 존재
   * 간접 라우팅의 대안으로 로컬 브레이크 아웃이 있지만 실제로 널리 사용되지 않음

 4. 한 기지국에서 다른 기지국으로의 이동 장치 핸드오버

<p align="center"><img width="600" alt="핸드오버" src="https://user-images.githubusercontent.com/86337233/216887712-02ebc640-42fc-4dfa-98ab-172886039029.jpg">

 * 현재의 기지국과 이동 장치 사이의 신호가 악화되거나 너무 많은 양의 트래픽을 처리해야 하는 경우 등과 같을 때 이동 장치는 주기적으로 현재 기지국의 비컨 신호와 주변 기지국의 신호 특성을 측정하여 핸드오버를 시작하도록 선택
 * 단계
   1) 출발 기지국은 목적지 기지국을 선택하고 목적지 기지국으로 핸드오버 요청 메시지를 보낸다
   2) 목적지 기지국이 충분한 자원(채널 및 기타)이 있는 경우 미리 자원을 할당하고 출발지 기지국에 핸드오버 요청 승인 메시지로 응답
   3) 출발지 기지국은 핸드오버 요청 승인 메시지를 수신하고 목적지 기지국의 ID 및 채널 접속 정보를 이동 장치에게 알려줌(이동 장치는 목적지 기지국과 데이터그램 송수신 가능)
   4) 출발지 기지국은 데이터그램을 이동 장치로 전송하는 것을 중지하고, 수신한 터널링 된 데이터그램을 목적지 기지국으로 전달
   5) 목적지 기지국은 MME에게 자신이 이동 장치를 서비스하는 새로운 기지국이 될 것임을 알리고 MME는 목적지 기지국에서 종료하도록 서빙 게이트웨이-기지국 터널 종단점을 재설정
   6) 목적지 기지국은 터널이 재구성되었음을 출발지 기지국에 확인 시키고 출발지 기지국이 해당 이동 장치와 관련된 자원을 해제(목적지 기지국도 이동 장치에 데이터그램 전달 가능)

  <br>

  ## 이동 IP

  ---

  - 에이전트 발견 : 이동 IP는 외부 에이전트가 네트워크에 결합하려는 이동 장치에게 이동성 지원 서비스를 광고하는 데 사용하는 프로토콜을 정의
  - 홈 에이전트와의 등록 : 이동 IP는 이동 장치의 홈 에이전트에 COA를 등록 및 취소하기 위해 이동 장치 및 외부 에이전트에서 사용하는 프로토콜 정의
  - 데이터그램의 간접 라우팅 : 데이터그램이 홈 에이전트에 의해 이동 장치로 전달되는 방식(데이터그램 전달, 오류 처리, 터널링) 정의

  ---

  ### 이동 IP 구조 및 프로토콜
   - 에이전트 발견 : 

 


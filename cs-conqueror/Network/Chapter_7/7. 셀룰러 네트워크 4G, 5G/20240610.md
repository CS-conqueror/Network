# 7.4 셀룰러 네트워크 : 4G, 5G

`셀룰러` : 셀룰러 네트워크의 영역이 전파 도달 능력에 따라 여러 개의 지리적 영역, 즉 **셀(cell)** 로 나뉜다는 사실에서 비롯됨
- 각각의 셀은 셀 영역 안의 **이동 장치(mobile device)** 와 신호를 주고 받는 **기지국(base station)** 을 갖고 있음 
- 하나의 셀이 담당하는 영역의 넓이는 여러 가지 요소에 의해 영향을 받음
    - 기지국의 송신 강도, 단말기의 송신 강도, 셀 내의 방해가 되는 건물, 기지국 안테나의 설치 높이와 종류 등

## 7.4.1 4G LTE 셀룰러 네트워크 : 구조 및 요소  

<p align="center"><img width="720" alt="4G LTE" src="https://user-images.githubusercontent.com/86337233/216772897-37222d77-892f-4f0a-9103-c63bed470f68.png">

<p align="center"><img width="950" alt="LTE 요소" src="https://user-images.githubusercontent.com/86337233/216772899-e027ff49-4b65-457b-9725-fbb2840f98bc.png">

네트워크는 크게 가장자리 부분의 무선 네트워크 부분과 코어 네트워크로 나뉨

- 이동 장치(mobile device)
    - 셀룰러 통신 사업자의 네트워크에 연결되는 스마트폰, 태블릿, 랩톱 또는 IoT 장치 등
    - 일반적으로 인터넷의 네트워크 가장자리에 있는 호스트에서 봤듯이 트랜스포트 및 애플리케이션 계층을 포함하여 전체 5계층 인터넷 프로토콜 스택을 구현
    - 이동 장치는 NAT를 통해 얻을 수 있는 IP 주소를 갖고 있는 네트워크의 종단점
    - 전 세계적으로 고유한 **IMSI(International Mobile Subscriber Identity)** 라는 64비트의 식별자가 있음
        - 이는 SIM(Subscriber Identity Module) 카드에 저장되며, 가입자가 속한 국가 및 홈 네트워크를 포함하여 전 세계의 셀룰러 사업자 시스템에서 가입자를 식별
        - SIM 카드는 가입자가 접속할 수 있는 서비스에 대한 정보와 해당 가입자의 키 정보를 암호화
    - 공식적인 4G LTE 전문 용어로 이동 장치는 UE(User Equipment)라고 함 

- 기지국(base station)
    - 셀룰러 통신 사업자 네트워크의 가장자리에 위치하며, 무선 전파 자원 및 담당 영역에 속한 이동 장치를 관리할 책임이 있음
    - 이동 장치는 기지국과 상호작용함으로써 사업자의 네트워크에 접속하는데, 이때 기지국은 무선 접속 네트워크에서 장치의 인증 및 자원(무선 채널)의 할당 기능을 조정
        - 이런 의미에서 셀룰러 기지국은 무선랜의 AP 기능과 비교됨(동일하지는 않음)
        - 그러나, 셀룰러 기지국은 여러 중요한 역할을 수행
            -  이동 장치에서 게이트웨이까지 장치 고유의 IP 터널을 생성하고 셀 간의 장치 이동성을 처리하기 위해 상호 작용함
            - 인접한 기지국들은 셀 사이의 간섭을 최소화하기 위해 무선 스펙트럼을 관리하기 위한 상호 조정 기능을 수행
    - 공식적인 4G LTE 전문 용어로 eNode-B라는 다소 불투명하고 설명이 부족한 이름으로 불림

 - 홈 가입자 서버(Home Subscriber Server, HSS)
    - HSS는 제어 평면의 요소
    - HSS의 네트워크를 홈 네트워크로 사용하는 이동 장치에 대한 정보를 저장하는 데이터베이스
    - 이동 장치의 인증을 위해 이동성 관리 개체(MME)와 함께 사용

<p align="center"><img width="700" alt="LTE 데이터 평면" src="https://user-images.githubusercontent.com/86337233/216772889-58669886-55d9-429f-978b-f05a5ed5e59d.jpg">

- S-GW(Serving Gateway), P-GW(Packet data Network Gateway), 그 밖의 네트워크 라우터
    - S-GW와 P-GW는 이동 장치와 인터넷 사이에 위치하며 실제로 자주 배치되는 2개의 라우터
    - PDN 게이트웨이는 이동 장치에 NAT IP 주소를 제공하고 NAT 기능을 수행
        - 또한, 이동 장치에서 시작된 데이터그램이 더 큰 인터넷으로 들어가기 전에 마지막으로 만나는 LTE 요소
        - 외부 세계에서 P-GW는 다른 게이트웨이 라우터와 마찬가지로 보임
    - 셀룰러 사업자의 LTE 네트워크 안에서 이동 노드의 이동성은 P-GW 뒤에 있는 바깥 세상에는 감추어짐
    - 이러한 게이트웨이 라우터 외에도 셀룰러 사업자의 all-IP 코어에는 전통적인 라우터 기능을 수행하는 라우터들이 존재
        - 이들은 IP 데이터그램을 LTE 코어 네트워크 안에서 종료하는 경로를 따라 전달
 
 - 이동성 관리 개체(Mobility Management Entity, MME)
    - 제어 평면의 요소
    - HSS와 함께 네트워크에 접속하련느 장치를 인증하는데 중요한 기능을 수행
    - 이동 장치와 PDN 인터넷 게이트웨이 간의 데이터 경로에 터널 설정
    - 사업자의 셀룰러 네트워크 안에서 활성화된 이동 장치의 셀 위치 정보를 유지 관리
    - 그러나, 이동 장치의 데이터그램이 인터넷으로 전송되거나 들어오는 전달 경로 상에 있지는 않음
 
 - 인증(authentication)
    - 네트워크는 부착된 장치가 실제로 주어진 IMSI와 연관된 장치라는 것을 알아야 하고, 이동 장치는 자신이 부착하고 있는 네트워크가 합법적인 셀룰러 사업자 네트워크라는 것을 알아야 함
    - MME는 이동 홈 네트워크에서 이동 장치와 홈 가입자 서버 HSS 사이의 중개자 역할을 함
        - 이동 장치와 접속 요청을 수신한 후 로컬 MME는 이동 장치의 홈 네트워크 HSS에 접촉
        - 그 후, 이동 장치의 홈 HSS는 홈 HSS가 이 MME를 통해 인증을 수행하고 있고, 이동 장치가 실제로 그 IMSI와 연관된 이동 장치임을 증명하기 위해 로컬 MME에 암호화된 정보를 충분히 반환
        - 이동 장치가 자신의 홈 네트워크에 연결되었다면 인증을 위해 연락할 HSS는 동일한 홈 네트워크 내에 위치
        - 그러나, 이동 장치가 다른 셀룰러 네트워크 사업자에 의해 운영되는 방문 네트워크상에서 로밍할 때, 그 로밍 네트워크 내의 MME는 이동 장치의 홈 네트워크 내에 있는 HSS에 접촉할 필요가 있음

- 경로 설정(path setup)
    - 이동 장치로부터 게이트웨이 라우터로의 데이터 경로는 이동 장치와 기지국 사이의 무선 첫 번째 홉, 기지국과 서빙 게이트웨이(S-GW) 사이의 연결된 IP 터널, 서빙 게이트웨이, PDN 게이트웨이로 구성
    - 터널은 MME의 제어 하에 설정되고, 장치가 이동할 때 장치 이동성을 용이하게 하기 위해 데이터 전달(네트워크 라우터 간 직접 전달이 아닌)에 사용
    - 장치가 다른 기지국으로 이동했을 때에 기지국에서 종료하는 터널 종단점만 변경되며, 다른 터널 종단점 및 터널과 관련된 서비스 품질은 변경되지 않음

- 셀 위치 추적(cell location tracking)
    - 이동 장치가 셀들 사이를 이동함에 따라, 기지국들은 이동 장치의 위치에서 MME를 갱신할 것
    - 이동 장치가 수면 모드에 있지만 그럼에도 불구하고 셀 사이를 이동하는 경우,     기지국은 더 이상 해당 장치의 위치를 추적할 수 없음
        - 이 경우 **페이징** 이라고 하는 프로세스를 통해 깨어난 장치를 찾는 것은 MME의 책임

## 7.4.2 LTE 프로토콜 스택
4G LTE는 all-IP 구조이므로, LTE 프로토콜 스택의 상위 계층은 IP, TCP, UDP 그리고 다양한 애플리케이션 계층 프로토콜들로 구성

새로 배울 LTE 프로토콜은 링크 계층과 물리 계층 그리고 이동성 관리에 초점을 둠

<p align="center"><img width="810" alt="LTE 데이터 평면 프로토콜 스택" src="https://user-images.githubusercontent.com/86337233/216772902-3851b6a6-ca23-46e7-bd21-2384d14f11d3.png">

새롭고 흥미로운 사용자 평면 프로토콜 활동의 대부분은 이동 장치와 기지국 사이의 무선 링크에서 발생

LTE는 이동 장치의 링크 계층을 다시 3개의 부계층으로 나눔
- 패킷 데이터 융합(Packet Data Convergence)
    - 링크 계층의 부계층 중 최상위, IP 바로 아래에 위치
    - PDCP(Packet Data Convergence Protocol)는 무선 링크를 통해 전송되는 비트 수를 줄이기 위해 IP 헤더 압축을 수행하며, LTE 이동 장치가 네트워크에 처음 연결될 때 이동 장치와 이동성 관리 개체(MME) 사이의 시그널링 메세지 교환을 통해 설정된 키를 사용한 암호화/복호화 기능을 수행

- 무선 링크 제어(Radio Link Control , RLC)
    - RLC 프로토콜은 두 가지 중요한 기능 수행
        - 링크 계층 프레임에 적용하기에는 너무 큰 IP 데이터그램의 송신 시 단편화 및 수신 시 재조립
        - ACK/NAK 기반 ARQ 프로토콜의 사용을 통한 링크 계층에서의 신뢰성 있는 데이터 전송

- 매체 접속 제어(Medium Access Control, MAC)
    - MAC 계층은 전송 스케줄링을 수행
        - 7.4.4절에서 설명한 무선 전송 슬롯의 요청 및 사용 제어를 의미
    - MAC 부계층은 추가적인 오류 감지/정정 기능을 수행하는데, 여기에는 중복 비트 사용을 통한 순방향 오류 정정 기능이 포함, 중복 데이터의 양은 채널 상태에 따라 조정 가능

그림 7.21은 사용자 데이터 경로에서 터널의 사용을 보여줌 <br/>
이러한 터널은 MME 제어하에 이동 장치가 처음으로 네트워크에 연결될 때 설정
- 두 종단점 사이의 각 터널에는 고유한 터널 종단점 식별자(tunnel endpoint identifier, TEID)가 있음
- 기지국은 이동 장치에서 데이터그램을 수신하면 TEID를 포함한 GPRS 터널링 프로토콜을 사용하여 데이터그램을 캡슐화하고 UDP 세그먼트로 터널의 다른 쪽 끝에 있는 서빙 게이트웨이로 보냄
- 수신 측에서 기지국은 터널링된 UDP 데이터그램을 캡슐 해제하고 이동 장치로 향하는 IP 데이터그램을 추출하여 무선 홉을 통해 해당 IP 데이터그램을 이동 장치로 전달

## 7.4.3 LTE 무선 접속 네트워크

LTE는 다운스트림 채널에서 주파수 분할 다중화와 시분할 다중화를 조합한 기술을 사용하는데, 이 기술은 직교 주파수 분할 다중화(frequency division multiplexing, OFDM)로 알려져 있음

더 많은 시간 슬롯을 할당할 수록 이동 장치는 더 높은 전송 속도를 달성할 수 있음

이동 장치에 대한 특정 타임 슬롯의 할당은 LTE 표준에 의해 의무화되어 있지 않지만, 어떤 이동 장치가 주어진 주파수에서 주어진 시간 슬롯에 전송하도록 허용될 것인지에 대한 결정은 LTE 장비 공급자 또는 네트워크 운영자가 제공하는 스케줄링 알고리즘에 의해 결정

## 7.4.4 추가적인 LTE 기능 : 네트워크 접속과 전원 관리

### 네트워크 접속

이동 장치가 셀룰러 사업자의 네트워크에 접속하는 절차는 세 단계로 나뉨
- 기지국과의 접속
    - 셀룰러 사업자 네트워크에 접속하려는 이동 장치는 부트스트랩 과정을 통해 근처 기지국에 대해 학습하고 결합
    - 이동 장치는 초기에 모든 주파수 대역의 모든 채널에서 기지국에 의해 5ms마다 주기적으로 브로드캐스트 되는 기본 동기화 신호를 검색
    - 이 신호가 발견되면 이동 장치는 해당 주파수를 유지하고 보조 동기화 신호 탐색
    - 두 번째 신호에서 찾은 정보와 몇 가지 추가 단계를 거쳐 이동 장치는 채널 대역폭, 채널 구성 및 해당 기지국의 셀룰러 사업자 정보와 같은 추가 정보 탐색 가능
    - 이 정보로 연결할 기지국을 선택하고 해당 기지국과의 무선 홉을 통해 제어 평면의 신호 연결 설정 가능

- 상호 인증
    - 기지국이 MME에 접속하여 상호 인증 수행
        - 네트워크 접속의 두 번째 단계로서, 네트워크는 접속하려는 장치가 실제로 우저니 IMSI와 연관된 장치이면서, 이동 장치는 접속 시도 중인 네트워크가 합법적 셀룰러 사업자 네트워크임을 알 수 있음
        - 이 단계가 완료되면 MME와 이동 장치가 상호 인증되고 MME도 이동 장치가 연결된 기지국의 ID를 알게 됨
        - 이 정보를 획득한 MME는 이제 이동 장치와 PDN 게이트웨이 간 데이터 경로를 구성할 수 있게 됨

- 매체 이동 장치와 PDN 게이트웨이 간 경로 구성
    - MME는 PDN 게이트웨이, 서빙 게이트웨이, 기지국에 연결하여 그림 7.21에 표시된 2개의 터널을 설정, 이 단계가 완료되면 이동 장치는 기지국과 연결된 터널을 통해 인터넷과 IP 데이터그램 송수신 가능

### 전력 관리 : 수면 모드

- 불연속 수신 상태
    - 이동 장치와 기지국은 이동 장치가 깨어나기 위한 주기적인 시간을 미리 예약한 후, 주기적으로 기지국에서 이동 장치로의 다운스트림 전송을 위해 채널을 능동적으로 모니터링.
    - 이 예정된 스케줄링 시간과 별개로 이동 장치의 무선 부분은 수면 상태일 수 있음
    - '약한 수면'으로 간주

- 유휴 상태
    - 이동 장치의 무선 부분은 깨어나서 채널을 모니터링하는 작업을 훨씬 덜 수행
    - 유휴 상태에서 깨어날 때 이동 장치는 MME가 이동 장치가 마지막으로 결합했던 기지국 근처의 다른 기지국들로 브로드캐스트하는 페이징 메세지를 확인하기 위해 (잠재적으로 새로운) 기지국과의 결합을 재설정해야 함
    - 이러한 제어 평면 페이징 메세지는 기지국에 의해 해당 셀 내의 모든 이동 장치로 브로드캐스트되며, 어떤 이동 장치가 패킷을 수신하기 위해 완전히 깨어나야 하고 기지국에 대한 새로운 데이터 평면 연결을 재설정해야 하는지를 나타냄

## 7.4.5 글로벌 셀룰러 네트워크 : 네트워크들의 네트워크

`네트워크들의 네트워크` : 글로벌 셀룰러 네트워크

<p align="center"><img width="550" alt="글로벌 셀룰러 데이터 네트워크" src="https://user-images.githubusercontent.com/86337233/216772906-1274e7ad-742a-4f23-a626-bf1525b8f805.jpg">

위 사진은 사용자의 스마트폰이 4G 기지국을 통해 **홈 네트워크(home network)** 에 연결되는 모습을 보여줌
 
모바일 네트워크 자체는 공용 인터넷 또는 IPX(Internet Protocol Packet eXchange) 네트워크를 통해 상호연결됨, IPX는 셀룰러 통신 사업자를 상호연결하기 위한 관리 네트워크

4G 네트워크는 3G 셀룰러 음성/데이터 네트워크 및 이전의 음성 전용 네트워크와도 피어링 할 수 있음

## 7.4.6 5G 셀룰러 네트워크

5G는 궁극적인 광역 데이터 서비스의 목표를 달성하기 위한 큰 발걸음을 내디딜 것으로 기대
<br/>
5G는 4G에 비해 대략 10배의 최대 비트전송률, 10배 빠른 지연 시간, 그리고 100배 이상의 트래픽 용량 제공할 것

중요한 것은 5G의 물리 계층(즉, 무선은) 측멱은 LTE와 같은 4G 이동 통신 시스템과 역방향 호환이 되지 않는다는 것
<br/>
따라서, 5G로의 전환을 위해 이동 통신 사업자는 물리적 인프라에 상당한 투자를 해야 함

### 새로운 5G 핵심 네트워크 기능
- 사용자 평면 기능
    - 제어와 사용자 편면 분리를 통해 패킷 처리를 네트워크 가장자리로 보내 분산시킬 수 있음

- 접속 및 이동성 관리 기능
    - 5G 코어는 기본적으로 4G MME를 AMF와 SMF의 두 가지 기능 요소로 분리
    - AMF는 최종 사용자 장치로부터 모든 연결 및 세션 정보를 수신하지만, 연결 및 이동성 관리 작업만 처리

- 세션 관리 기능
    - 세션 관리는 SMF에 의히 처리
    - SMF는 제어와 분리된 데이터 평면과의 상호작용 담당
    - 또한, IP 주소 관리 담당 및 DHCP 역할 수행

<hr/>
P-GW 뒤 : 이동 장치(스마트폰 등)가 네트워크 내에서 이동할 때 외부 네트워크(인터넷)에서는 그 이동을 알 수 없다는 것, P-GW 뒤쪽은 주로 데이터 평면을 말함
<br/>
NAT : 사설 IP 주소를 공인 IP 주소로 변환하는 데 사용
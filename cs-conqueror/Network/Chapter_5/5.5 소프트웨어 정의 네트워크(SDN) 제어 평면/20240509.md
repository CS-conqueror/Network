## 5.5 소프트웨어 정의 네트워크(SDN) 제어 평면

<p align="center"><img width="600" alt="SDN의 구성요소" src="https://user-images.githubusercontent.com/86337233/213711658-f229ca35-e7a3-4818-b85f-ac2276e417e5.png">

- ‘패킷 스위치’
    - 네트워크의 포워딩 장비
- SDN 구조의 네 가지 특징
    - 플로우 기반 포워딩
        - SDN으로 제어되는 스위치들에서의 패킷 전달은 트랜스포트/네트워크/링크 계층 헤더의 어떤 값을 기반으로 하든 이루어질 수 있음
        - 전통적인 라우터 기반 포워딩과는 매우 대조적
            - 전통적인 포워딩 : 온전히 데이터 그램의 목적지 주소를 기반으로 이루어짐
            - SDN : 11가지의 헤더값을 기반으로 포워딩 할 수 있도록 허용
        - SDN 제어 평면의 임무
            - 모든 네트워크 스위치의 플로우 테이블 항목들을 계산, 관리, 설치
    - 데이터 평면과 제어 평면의 분리
        - 데이터 평면은 네트워크 스위치로 구성
            - 상대적으로 단순한 장치들로서 자신들의 플로우 테이블 내용을 기반으로 ‘매치 플러스 액션’ 수행
        - 제어 평면은 서버와 스위츠들의 플로우 테이블을 결정/관리하는 소트프웨어로 구성
    - 네트워크 제어 기능이 데이터 평면 스위치 외부에 존재
        - SDN 제어 평면은 소프트웨어로 구성
            - 전통적인 라우터들과는 달리, 이 소프트웨어는 네트워크 스위치로부터 멀리 떨어진 별도의 서버에서 수행
        - 제어 평면은 SDN 컨트롤러와 네트워크 제어 애플리케이션들의 집합으로 구성
            - 컨트롤러
                - 정확한 상태 정보 유지
                - 제어 평면에서 동작하고 있는 네트워크 제어 애플리케이션들에 이러한 정보 제공
                - 애플리케이션들이 하부 네트워크 장치들을 모니터/프로그램/제어 할 수 있도록 수단 제공
                - 실제 컨트롤러는 논리적으로만 단일 중앙 서버 형태
                    - 일반적으로는 협업, 확장성, 높은 이용성을 위해 몇 개의 서버에 구현
    - 프로그램이 가능한 네트워크
        - 네트워크 제어 애플리케이션을 토해 네트워크 프로그램 가능
        - SDN 제어 평면의 ‘두뇌’로서 SDN 컨트롤러가 제공하는 API를 이용하여 네트워크 장치들에 있는 데이터 평면을 명세하고 제어


⇒ SDN이 네트워크 기능들의 획기적인 `분리` 를 의미함을 알 수 있음

데이터 평면 스위치와 SDN 컨트롤러 그리고 네트워크 제어 애플리케이션들 각각은 분리된 개체

<br>

이는 하나로 단단히 짜여지고 계층 수직적으로 통합된 스위치/라우터를 구입하던 이전의 네트워크 모델과 대조적

<br>

SDN에서의 이러한 네트워크 기능의 분리는 이전의 메인 프레임 컴퓨터에서 개인용 컴퓨터로의 진화에 비유

### 5.5.1 SDN 제어 평면 : SDN 컨트롤러와 SDN 네트워크 제어 어플리케이션

<p align="center"><img width="580" alt="SDN 컨트롤러 구성요소" src="https://user-images.githubusercontent.com/86337233/213711664-270bb750-0349-4109-aaca-cc97627caee1.png">

SDN 제어 평면은 크게 SDN 컨트롤러와 SDN 네트워크 제어 어플리케이션으로 구성

- 컨트롤러의 기능은 크게 3개의 계층으로 구성
    - 통신 계층
        - SDN 컨트롤러와 제어 받는 네트워크 장치들 사이의 통신
        - SDN 컨트롤러가 원격 SDN 기능이 가능한 스위치, 호스트, 다른 장치들의 동작을 제어하기 위해서는 정보를 전달하는 프로토콜이 필요 + 주변에서 관찰한 이벤트를 컨트롤러에 알릴 수 있어야 함
            - 이러한 이벤트들은 SDN 컨트롤러에게 네트워크 상태 최신 정보를 제공
        - 컨트롤러 구조의 가장 하위 계층을 구성
            - 사우스바운드
                - 컨트롤러와 장치들의 간의 통신은 사우스 바운드 컨트롤러 인터페이스를 넘나듦
    - 네트워크 전역 상태 관리 계층
        - SDN 제어 평면의 궁극적인 제어 결정을 위해서는 다른 장치들에 대한 최신 정보를 알아야 함
        - 스위치의 플로우 테이블이 갖는 카운터는 네트워크 제어 어플리케이션들에게 유익한 정보
        - 제어 평면의 궁극적인 목적
            - 다양한 제어 장치들의 플로우 테이블을 결정하는 것
                - 그러므로 컨트롤러도 이 테이블들의 복사본을 유지해야 함
    - 네트워크 제어 어플리케이션 계층과의 인터페이스
        - 컨트롤러는 ‘노스바운드’ 인터페이스를 통해 네트워크 제어 어플리케이션과 상호작용
            - 이는 네트워크 제어 어플리케이션이 상태 관리 계층 내의 네트워크 상태 정보와 플로우 테이블을 읽고 쓸 수 있게 해줌

컨트롤러는 ‘논리적으로 중앙 집중된’ 것처럼 보이기 때문에 외부에서 볼 때 잘 짜여진 하나의 서비스로 보임

<br>

하지만 이 서비스들과 상태 정보를 보관하는 데이터베이스는 장애 허용성, 높은 가용성, 다른 성능상의 이유로 실제로는 `분산된` 서버의 집합에 구현

<br>

서버 집합에 구현되는 컨트롤러 기능들 때문에 컨트롤러의 내부 동작들이 의미가 고려되어야 함

### 5.5.2 OpenFlow 프로토콜

TCP 상에서 디폴트 포트 번호 6653을 가지고 동작

- 컨트롤러가 제어되는 스위치로 전달하는 중요한 메세지
    - 설정
        - 컨트롤러가 스위치의 설정 파라미터들을 문의하거나 설정할 수 있도록 함
    - 상태 수정
        - 컨트롤러가 스위치 플로우 테이블의 엔트리를 추가/제거 또는 수정하거나 스위치 포트의 특성을 설정하기 위해 사용
    - 상태 읽기
        - 컨트롤러가 스위치 플로우 테이블과 포트로부터 통계 정보와 카운터값을 얻기 위해 사용
    - 패킷 전송
        - 컨트롤러가 제어하는 스위치의 지정된 포트에서 특정 패킷을 내보내기 위해 사용
        - 메세지 자체는 페이로드 부분에 보낼 패킷을 포함
- SDN으로 제어되는 스위치에서 컨트롤러로 전달되는 주요 메세지
    - 플로우 제거
        - 컨트롤러에게 어떤 플로우 테이블 엔트리가 시간이 만료되었거나 **상태 수정** 메세지를 수신한 결과로 삭제되었음을 알림
    - 포트 상태
        - 스위치가 컨트롤러에게 포트의 상태 변화를 알리기 위해 사용
    - 패킷 전달
        - 플로우 테이블의 어떤 엔트리와도 일치하지 않는 패킷은 처리를 위해 컨트롤러에게 전달
        - 일치한 패킷 중에서도 일부는 그에 대한 작업을 수행하기 위해 컨트롤러에게 보내지기도 함
        - 그러한 패킷을 컨트롤러에게 보내기 위해 사용

### 5.5.3 데이터 평면과 제어 평면의 상호작용

다익스트라 알고리즘이 최단 결로를 결정하기 위해 사용

<p align="center"><img width="500" alt="SDN 컨트롤러 시나리오" src="https://user-images.githubusercontent.com/86337233/213711666-386f50a2-908c-4aad-b862-92b868626000.png">

다익스트라 알고리즘이 모든 개별 라우터에 구현되고 링크 상태 갱신 정보가 모든 네트워크 라우터 사이에서 플러딩되는 라우터별 제어 시나리오와 차이가 있음

- 다익스트라 알고리즘이 패킷 스위치 외부에서 별도의 애플리케이션으로 수행
- 패킷 스위치들이 링크 갱신 정보를 서로 간이 아닌 SDN 컨트롤러에게 전송

컨트롤러가 마음대로 플로우 테이블을 변경할 수 있기 때문에 단순히 애플리케이션 제어 소프트웨어를 바꿈으로써 원하는 어떤 형태의 포워딩 방식도 구현할 수 있음 

<br>

이러한 변경의 용이성은 모둔 라우터의 소프트웨어를 바꿔야 했던 전형적인 라우터별 제어 평면의 경우와 대조적임

### 5.5.4 SDN 과거와 미래

- **단순한 상용 스위칭 하드웨어와 정교한 소프트웨어 제어 평면**으로 **모든 기능이 하나로 통합된 스위치와 라우터**를 교체해나가고 있음
- 연구의 두 번째 중요한 영역은 SDN 개념을 AS 내부 설정에서 AS 간 설정으로 확장하려는 것임
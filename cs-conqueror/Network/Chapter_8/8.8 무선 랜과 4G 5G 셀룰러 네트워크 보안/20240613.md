# 8.8 무선 랜과 4G/5G 셀룰러 네트워크 보안

공격자가 수신 장치를 전송 범위 안에 존재하도록 위치시킴으로써 간단히 프레임들을 알아챌 수 있기 때문에, 무선 네트워크에서의 보안은 특별히 중요
<br/>
이러한 경우는 802.11 무선 랜뿐만 아니라 4G/5G 네트워크에도 해당

## 8.8.1 802.11 무선 랜의 인증키와 키 합의

802.11 네트워크에서 다루어야 할 두 가지 핵심 보안 관심사
- 상호 인증(mutual authentification)
    - 이동 장치가 AP에 완전히 접속하여 원거리 호스트에게 데이터그램 전송 전, 대부분의 경우 네트워크는 접속하는 이동 장치의 신원을 확인하고, 접속 권한을 점검하기 위해 장치를 인증하기 원할 것
    - 마찬가지로, 접속하는 네트워크가 진짜 접속을 원하는 네트워크가 맞는지 네트워크를 인증하기 원할 것
    - 이러한 양방향 인증을 **상호 인증** 이라고 함

- 암호화
    - 802.11  프레임이 잠재적인 전혀 쓸모없는 사람들에 의해 알려지거나 조작될 수 있는 무선 채널을 통해 교환되기 때문에, 이동 장치와 AP 간에 교환되는 사용자 레벨 데이터를 지나고 있는 링크 레벨 프레임의 암호화가 중요
    - 암호화 / 복호화가 높은 속도로 이루어져야 하기 때문에, 실제로는 대칭키 암호화 사용

<br/>
<p align="center"><img width="500" src="https://user-images.githubusercontent.com/76640167/218796266-8169a7a8-e4db-4d88-a283-ee029bd2726f.png" alt="절차"></p>

- 두 가지 일반적인 네트워크 구성요소
    - 이동 장치
    - AP
- 이동 장치를 인증하기 위한 **인증 서버** 
    - AP에 함께 위치할 수도 있으나, 인증 서비스를 제공하는 독립적인 서버로 구현되는 것이 전형적임
    - 인증을 위해 AP는 이동 장치와 인증 서버 간의 인증과 키 생성 메세지를 전달하는 경유 장치로서의 역할 수행

<br/>

상호 인증과 암호화 키 생성 및 사용 절차 4단계
- 발견(discovery)
    - AP는 자신의 존재와 함께 이동 장치에게 제공될 수 있는 인증과 암호화 형식 알림
    - 이동 장치는 원하는 특정 인증과 암호화 형식을 요청
    - 이동 장치가 AP를 통해 안전한 통신을 하기 전에 여러 단계가 더 필요
- 상호 인증과 공유 대칭키 생성
    - 802.11 채널을 `안전하게` 하는 가장 중요한 단계
    - 상호 인증을 시작하기 이전 인증 서버와 이동 장치 간에 이미 **공유된 공통의 비밀** 을 갖고 있다고 가정함으로써 이루어짐
    - 이동 장치와 인증 서버는 서로 간의 인증에 넌스(릴레이 공격 방지)와 암호화 해싱 등과 함께 공유 비밀을 이용
    - 이동 장치와 AP 간의 802.11 무선 링크를 통해 전송될 프레임의 암호화에 사용될 공유 세션키 생성
- 공유 대칭 세션키 분배
    - 대칭 비밀키는 이동 장치와 인증 서버에서 생성되기에, 인증 서버가 AP에게 공유 대칭 세션키를 알려주기 위한 프로토콜이 필요해짐
- AP를 통한 이동 장치와 원격 호스트 간의 암호 통신
    - 2, 3단계에서 생성되고 분배된 공유 세션키를 사용하여 이동 장치와 AP 간의 암호화된 링크 계층 프레임을 가지고 통신이 이루어짐
    - AES 암호화가 실제로 사용됨

### 상호 인증과 공유 대칭 세션키 생성

WPA의 핵심은 상호 인증과 함께 공유 대칭 세션키 생성을 수행하는 네 방향 핸드셰이크 프로토콜

<p align="center"><img width="500" src="https://user-images.githubusercontent.com/76640167/218796256-1bbfc9c3-d8a0-4db0-babd-44c69a83f6d2.png" alt="상호 인증과 공유 대칭키"></p>

- 이동 장치와 인증 서버(AS) 모두가 공유 비밀키 K AS-M을 알고 있음
    - 또 다른 작업은 이동 장치(M)와 AP 간에 전송될 프레임의 암/복호화에 사용될 공유 대칭키를 생성하는 것
- 상호 인증과 공유 대칭 세션키 생성은 네 방향 핸드셰이크의 첫 두 단계인 a, b에서 이루어짐
- c, d단계는 그룹 통신에서 사용되는 두 번째 키를 생성하는데 사용

### 802.11 보안 메시징 프로토콜

확장 인증 프로토콜(Extensible Authentifiaction Protocol, EAP)은 이동 장치와 인증 서버 간의 단순한 요청/응답 모드의 상호작용에 사용되는 종단 간의 메세지 포맷을 정의

<p align="center"><img width="500" src="https://user-images.githubusercontent.com/76640167/218797046-55dc787e-6cf4-41da-96f7-9dda1e363ee0.png" alt="프로토콜"></p>

- EAP 메세지들은 EAPoL을 사용하여 캡슐화되며 802.11 무선 링크로 전송
- EAP 메세지들은 AP에서 역캡슐화되며, RADIUS 프로토콜을 사용하여 재캡슐화되어 UDP/IP를 통해 인증 서버로 전송

## 8.8.2 4G/5G 셀룰러 네트워크에서의 인증과 키 동의

4G/5G 환경에서의 상호 인증과 키 생성의 목적들은 802.11 환경에서와 동일
- 무선 채널로 전송되는 프레임의 내용을 암호화하기 위해 이동 장치와 기지국은 공유 대칭 암호화 키를 유도할 필요가 있음
- 이동 장치가 접속할 네트워크도 이동 장치의 식별자와 접속 권한을 점검할 필요가 있음
- 마찬가지로 이동 장치 또한 접속할 네트워크를 인증하기를 원하게 됨
- 셀룰러 네트워크에 접속할 때도 이동 장치는 상당한 주의를 요하게 됨

<p align="center"><img width="500" src="https://user-images.githubusercontent.com/76640167/218796233-05da2b86-db94-4546-8507-1489d7379783.png" alt="4G"></p>

- 이동 장치와 기지국을 보게 되는데, 무선 링크를 통해 전송될 프레임의 암/복호화에 사용될 사용자 세션키 K BS-M은 네트워크 접속 시 유도
- 4G MME와 HSS는 함께 802.11 환경에서의 인증 서버와 유사한 역할 수행
- HSS와 이동 장치는 인증이 시작되기 전에 둘 다 알고 있는 공통의 비밀 K HSS-M을 공유함
    - 이 키는 이동 장치의 SIM 카드와 이동 장치 홈 네트워크의 HSS 데이터베이스에 저장
<br/>

4G 인증과 키 동의(Authentification and Key Agreement, AKA) 프로토콜
- HSS에 인증 요청
    - MME로 전달되는 기기의 국제 이동 가입자 식별자(IMSI)를 포함하는 접속 메세지 전송 
    - MME는 MISI와 네트워크 관련 정보를 이동 장치의 HSS로 보냄
- HSS로부터의 인증 응답
    - HSS는 사전 공유 비밀키인 K HSS-M을 사용하여 인증 토큰과 예상되는 인증 응답 토큰을 유도하기 위해 암호화 동작을 수행
    - auth_token은 이동 장치가 비밀키를 알고 있다는 사실을 인지하게 하는 K HSS-M을 사용하여 HSS가 암호화한 정보 포함(IMSI를 계산하여 auth_token을 생성한 HSS가 비밀키를 알고 있음을 인지)
    - MME만이 인증 응답 메세지를 받고 향후 사요을 위해 xres를 저장하고 인증 토큰을 추출하여 이동 장치에 전송하는 중간자 역할을 하게 됨
- 이동 장치로부터의 인증 응답
    - 이동 장치는 auth-token을 받아 IMSI를 계산하여 HSS를 인증
- 이동 장치 인증
    - MMS는 이동 장치가 계산한 값과 HSS가 계산한 값이 일치하면 상호 인증 완료를 알리고, 기지국 키를 보냄
- 데이터 평면과 제어 평면 키 도출
    - 이동 장치와 기지국은 무선 채널을 통해 프레임 전송에 사용될 암/복호화 키를 각자 결정
    - 데이터 평면과 제어 평면 정송을 위한 개별적인 키 도출

5G 에서의 변화
- 5G 네트워크에서는 MME가 아니라 방문지 네트워크가 더 작은 중간자 역할을 수행하면서 인증 서비스를 허용함
- 두 가지 새로운 인ㄴ증과 키 동의를 위한 프로토콜 지원
    - AKA'로 알려진 새로운 프로토콜 지원
    - IoT 환경을 의미하며, 사전 공유 비밀키가 요구되지 않음
- 장치의 영구적인 아이덴티티를 암호화하기 위해 공개키 암호화 기버비을 사용하여 평문으로는 절대 전송되지 않음



<hr/>
Nonce : Number used Once, 한 번만 사용되는 임의의 숫자나 문자열 - 반복되는 공격 방지